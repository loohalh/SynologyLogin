!function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=3)}([function(e,t){e.exports=Vuex},function(e,t){e.exports=Vue},function(e,t){e.exports=VueRouter},function(e,t,s){e.exports=s(4)},function(e,t,s){"use strict";s.r(t);var i=s(1),o=s.n(i),a=s(0),n=s.n(a),r=s(2),l=s.n(r),c={state:{isNeedPersonalUpdater:!1,tpl:{},appLoginStyle:"",isSpecificAccount:!1,isSupportSSO:!1,isSupportOIDCSSO:!1,otpUrl:null,stayLogin:!1,trustDevice:!1,showOTPField:!1,message:"",messageStyle:"info",needReloadTabs:!1,activeTabName:"",disableForm:!1,showUpgradeMask:!0,onLoginProcedure:!1,isSpinning:!1,isBombingOnDone:!1,loadPluginsPromise:Promise.resolve(),loginPluginsLoaded:!1,dsmForm:{username:"",password:"",SSOToken:"",OTPcode:""},authList:[],need2FA:!1,selectAuthType:"",isUseSSO:!1,oidc:{isUse:!1,params:{}}},actions:{async fetchAuthList({dispatch:e,state:t,commit:s},i=""){let o;try{o=await synowebapi.promises.request({url:"webapi/entry.cgi",requestFormat:"raw",params:{api:"SYNO.API.Auth.Type",method:"get",version:1,account:i}})}catch(e){SYNO.Debug.error(e)}Array.isArray(o)&&o.length>0||(o=[{type:"passwd"}]),localStorage.removeItem("choseAuthType");let a=SYNO.SDS.PreferAuthType.Get(i);return a&&o.sort((e,t)=>e.type===a?-1:t.type==a?1:0),s("updateDsmUsername",i),await e("setAuthList",o),t.enabledAuthList},updateTpl({commit:e},t){e("updateTpl",new SYNO.SDS.LoginStyleParser({isPreview:t,isBusiness:SYNO.SDS.isBusinessModel}).getLoginConfig())},updateAppLoginStyle({commit:e}){SYNO.SDS.Session.appLoginStyle&&e("updateAppLoginStyle",SYNO.SDS.Session.appLoginStyle)},switchToTab({commit:e},t){e("updateActiveTabName",t),e("updateNeedReloadTabs",!0)},setErrorMessage({commit:e},t){e("updateMessage",t),e("updateMessageStyle","error")},setInfoMessage({commit:e},t){e("updateMessage",t),e("updateMessageStyle","info")},clearMessage({commit:e}){e("updateMessage",""),e("updateMessageStyle","info")},loginPluginsLoaded({commit:e},t){e("loginPluginsLoaded",t)},async setAuthList({commit:e,state:t},s=[]){e("updateAuthList",s)},setNeed2FA({commit:e},t){e("need2FA",t)},clearAuthInfo({commit:e}){e("need2FA",!1),e("updateAuthList",[]),e("updateDsmPassword",""),e("updateDsmSSOToken",""),e("updateDsmOTPcode",""),e("updateShowOTPField",!1),e("updateStayLogin",!1),e("updateTrustDevice",!1),e("updateIsUseSSO",!1),e("updateOidcIsUse",!1),e("updateOidcParams",{})},async needPersonalUpdate({commit:e}){const t=await synowebapi.promises.request({api:"SYNO.Core.Desktop.PersonalUpdater",method:"need_update",version:1}),s=SYNO.SDS.isCompatibleMode&&SYNO.SDS.isCompatibleMode();e("updatePersonalUpdater",t.need_update&&!s)}},mutations:{updateTpl(e,t){e.tpl=t},updateMessage(e,t){e.message=t},updateMessageStyle(e,t){e.messageStyle=t},updateSupportSSO(e,t){e.isSupportSSO=t},updateSupportOIDCSSO(e,t){e.isSupportOIDCSSO=t},updateDsmUsername(e,t){e.dsmForm.username=t},updateDsmPassword(e,t){e.dsmForm.password=t},updateDsmSSOToken(e,t){e.dsmForm.SSOToken=t},updateDsmOTPcode(e,t){e.dsmForm.OTPcode=t},updateStayLogin(e,t){e.stayLogin=t},updateTrustDevice(e,t){e.trustDevice=t},updateShowOTPField(e,t){e.showOTPField=t},updateNeedReloadTabs(e,t){e.needReloadTabs=t},updateActiveTabName(e,t){e.activeTabName=t},updateAppLoginStyle(e,t){e.appLoginStyle=t},updateDisableForm(e,t){e.disableForm=t},updateShowUpgradeMask(e,t){e.showUpgradeMask=t},updateOnLoginProcedure(e,t){e.onLoginProcedure=t},updateLoadPluginsPromise(e,t=Promise.resolve()){e.loadPluginsPromise=t},updateOtpUrl(e,t=null){e.otpUrl=t},updatePersonalUpdater(e,t){e.isNeedPersonalUpdater=t},loginPluginsLoaded(e,t){e.loginPluginsLoaded=t},updateAuthList(e,t=[]){e.authList=t},need2FA(e,t){e.need2FA=t},enableSpinning(e,t=!1){e.isSpinning=t},enableBombingOnDone(e,t=!1){e.isBombingOnDone=t},enableSpecificAccount(e,t=!0){e.isSpecificAccount=t},updateIsUseSSO(e,t){e.isUseSSO=t},updateOidcIsUse(e,t){e.oidc.isUse=t},updateOidcParams(e,t){e.oidc.params=t}},getters:{username:e=>e.dsmForm.username,password:e=>e.dsmForm.password,hostname:e=>Object.prototype.hasOwnProperty.call(e.tpl,"login_title")?e.tpl.login_title:"",enabledAuthList:e=>(e.loginPluginsLoaded,e.authList.filter(e=>SYNO.SDS.LoginPlugins.getPlugin(e.type)))},namespaced:!0,strict:!0},p={state:{qrcodeImg:"",secretKey:"",email:"",serverAddr:"",userDN:"",isLDAP:!1,account:""},mutations:{updateQrcodeImg(e,t){e.qrcodeImg=t},updateSecretKey(e,t){e.secretKey=t},updateEmail(e,t){e.email=t},updateServerAddr(e,t){e.serverAddr=t},updateUserDN(e,t){e.userDN=t},updateIsLDAP(e,t){e.isLDAP=t},updateAccount(e,t){e.account=t}},getters:{},namespaced:!0,strict:!0},d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-wrapper",class:e.wrapperCls},[e.showPreviewBar?s("preview-bar"):e._e(),e._v(" "),s("toast",{ref:"toast"}),e._v(" "),e._m(0),e._v(" "),s("logo",{attrs:{tpl:e.tpl}}),e._v(" "),s("transition-group",{attrs:{name:"quick-fade",mode:"out-in"}},[e.isNeedPersonalUpdater?s("personal-updater",{key:"personal-updater"}):s("div",{key:"login-container",staticClass:"login-container"},[s("div",{staticClass:"login-header-section"}),e._v(" "),s("div",{staticClass:"login-body-section"},[s("div",{staticClass:"login-msg"},[s("message",{attrs:{tpl:e.tpl}})],1),e._v(" "),s("div",{staticClass:"login-tab-panel"},[s("tabs",{ref:"tabs",staticClass:"tab-panel",on:{"do-sso-init":e.onSynologySSOInit}},[s("dsm-tab-panel",{ref:"dsmLoginPanel",on:{"do-login":e.onLoginSubmit,spinning:e.onSpinning,"enable-bombing-on-done":e.onEnableBombingOnDone,"go-desktop":e.gotoDesktop,"show-toast":e.onShowToast}}),e._v(" "),s("sso-tab-panel",{on:{"do-login":e.onLoginSubmit}}),e._v(" "),s("oidc-sso-tab-panel",{on:{"do-login":e.onLoginSubmit}})],1)],1)]),e._v(" "),s("div",{staticClass:"login-footer-section"},[s("footer-msg")],1)])],1)],1)};d._withStripped=!0;var u={methods:{T:(e,t)=>_T(e,t)||t,format:(...e)=>String.format.apply(String,e),htmlEncode:e=>e?String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e,htmlDecode:e=>e?String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&"):e}},h={beforeMount:function(){this.$store.commit("mainPage/updateSupportSSO",SYNO.SDS.SSOUtils.isSupport()),this.$store.commit("mainPage/updateSupportOIDCSSO",this.checkSupportOIDCSSO())},methods:{onSSOLoginSubmit:function(){if("oidcssoTabPanel"===this.activeTabName){if("azure"===_S("oidc_sso_profile"))return void SYNO.SDS.AzureSSOUtils.login(this.onOIDCSSOCallback,this);if("websphere"===_S("oidc_sso_profile"))return void SYNO.SDS.WebSphereSSOUtils.login(this.onOIDCSSOCallback,this);if("oidc"===_S("oidc_sso_profile"))return void SYNO.SDS.OIDCSSOUtils.login(this.onOIDCSSOCallback,this)}"ssoTabPanel"!==this.activeTabName||SYNO.SDS.SSOUtils.login(this.onSSOCallback,this)},onSSOCallback:function(e){if("login"===e.status&&e.access_token&&40===e.access_token.length){var t={token:e.access_token};synowebapi.request({api:"SYNO.Core.Directory.SSO.utils",method:"exchange",version:1,params:t,scope:this,callback:function(e,s){this.onGotSSOUsername(e,s,t)}})}},onOIDCSSOCallback:function(e,t){t.type="sso",e.oidcIsUse=!0,e.oidcParams=t,e.startLoginProcedure()},onGotSSOUsername:function(e,t,s){e?(this.isUseSSO=!0,this.username=t.user.replace("\\\\","\\"),this.SSOToken="SYNOSSOLOGIN"+s.token,this.startLoginProcedure()):this.handleError("SSO login fail")},checkSupportOIDCSSO:function(){if(!(_S("oidc_sso_enable")&&"https:"===location.protocol))return!1;if(!_S("oidc_redirect_uri"))return!1;if(!this.validURL(_S("oidc_redirect_uri")))return!1;var e=document.createElement("a");return e.href=_S("oidc_redirect_uri"),e.hostname===location.hostname},validURL:function(e){let t=e.replace(/https?:\/\/\[/i,"").replace(/\].*$/,"");return!1!==/^(https?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)||!1!==/((^https?):\/\/([a-z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*)(:\d+)?$/i.test(e)||!1!==/^((([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4})|(([0-9a-fA-F]{1,4}:){1,7}:)|(([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4})|(([0-9a-fA-F]{1,4}:){1,5}:([0-9a-fA-F]{1,4}:){0,1}[0-9a-fA-F]{1,4})|(([0-9a-fA-F]{1,4}:){1,4}:([0-9a-fA-F]{1,4}:){0,2}[0-9a-fA-F]{1,4})|(([0-9a-fA-F]{1,4}:){1,3}:([0-9a-fA-F]{1,4}:){0,3}[0-9a-fA-F]{1,4})|(([0-9a-fA-F]{1,4}:){1,2}:([0-9a-fA-F]{1,4}:){0,4}[0-9a-fA-F]{1,4})|([0-9a-fA-F]{1,4}::([0-9a-fA-F]{1,4}:){0,5}[0-9a-fA-F]{1,4})|(::([0-9a-fA-F]{1,4}:){0,6}[0-9a-fA-F]{1,4}))$/.test(t)}},computed:{SSOToken:{get(){return this.$store.state.mainPage.dsmForm.SSOToken},set(e){this.$store.commit("mainPage/updateDsmSSOToken",e)}},isSupportSSO(){return this.$store.state.mainPage.isSupportSSO},isSupportOIDCSSO(){return this.$store.state.mainPage.isSupportOIDCSSO},activeTabName(){return this.$store.state.mainPage.activeTabName}}},m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.tabCls},[s("div",{staticClass:"tab-mask-wrapper spinner"},[s("spinner",{staticClass:"tab-mask-center tab-mask-spinner"})],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isBombingOnDone,expression:"isBombingOnDone"}],staticClass:"tab-mask-wrapper"},[s("div",{staticClass:"tab-mask-center"},[s("bomber")],1)]),e._v(" "),s("div",{staticClass:"tab-wrapper"},[s("div",{staticClass:"tab-label-ct"},[e.showHostnameOnly?s("span",{staticClass:"tab-label hostname active",domProps:{innerHTML:e._s(e.hostname)}}):e._l(e.tabs,(function(t,i){return s("span",{key:i,staticClass:"tab-label",class:{active:t.isActive},on:{click:function(t){return e.setActiveTab(i)}}},[e._v(e._s(t.label))])}))],2),e._v(" "),s("div",{staticClass:"tab-content-ct"},[e._t("default")],2)])])};m._withStripped=!0;var g=function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{staticClass:"login-spinner",attrs:{viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"}},[t("g",{staticClass:"login-spinner-g"},[t("circle",{staticClass:"login-spinner-circle",attrs:{cx:"33",cy:"33","stroke-width":5,r:30.5}})])])};g._withStripped=!0;function _(e,t,s,i,o,a,n,r){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),i&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},c._ssrRegister=l):o&&(l=r?function(){o.call(this,this.$root.$options.shadowRoot)}:o),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(e,t){return l.call(t),p(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}var v=_({},g,[],!1,null,null,null);v.options.__file="js/components/spinner.vue";var f=v.exports,b=function(){var e=this.$createElement;return(this._self._c||e)("div",{ref:"bomber",staticClass:"bomber",style:this.wrapperStyles})};b._withStripped=!0;var S=_({computed:{wrapperStyles(){return{"background-color":this.color}},color(){return this.$store.state.mainPage.appLoginStyle.mainColor},scale:()=>2*(Math.max(document.body.offsetHeight,document.body.offsetWidth)/2)/36},beforeDestroy(){this.bombing()},methods:{reset(){this.$refs.bomber&&(this.$refs.bomber.style.transform="scale(0)")},bombing(){this.$refs.bomber&&(this.$refs.bomber.style.transform=`scale(${this.scale})`)}}},b,[],!1,null,"69e94c30",null);S.options.__file="js/components/bomber.vue";var w=_({components:{spinner:f,bomber:S.exports},data:()=>({tabs:[],active:0}),computed:{...Object(a.mapState)("mainPage",["isSpecificAccount"]),...Object(a.mapGetters)("mainPage",["hostname"]),showHostnameOnly(){return"/signin"!==this.$route.path},tabCls(){return{"login-tabs":!0,"only-one-tab":this.onlyOneTab,"app-custom":this.isCustomized,spinning:this.$store.state.mainPage.isSpinning}},isBombingOnDone(){return this.$store.state.mainPage.isBombingOnDone},onlyOneTab(){return 1===this.tabs.length&&!this.showHostnameOnly},isCustomized(){return this.appLoginStyle&&this.appLoginStyle.mainColor&&"#"===this.appLoginStyle.mainColor[0]},needReloadTabs:{get(){return this.$store.state.mainPage.needReloadTabs},set(e){this.$store.commit("mainPage/updateNeedReloadTabs",e)}},activeTabName(){return this.$store.state.mainPage.activeTabName},appLoginStyle(){return this.$store.state.mainPage.appLoginStyle},isSupportSSO(){return this.$store.state.mainPage.isSupportSSO},isSupportOIDCSSO(){return this.$store.state.mainPage.isSupportOIDCSSO}},created(){this.initAppStyle()},mounted(){this.loadTabs()},updated(){this.needReloadTabs&&this.loadTabs()},methods:{calcMainColor(e){if(e){let t=this.appLoginStyle.mainColor.replace("#","");return"rgba("+parseInt(3==t.length?t.slice(0,1).repeat(2):t.slice(0,2),16)+", "+parseInt(3==t.length?t.slice(1,2).repeat(2):t.slice(2,4),16)+", "+parseInt(3==t.length?t.slice(2,3).repeat(2):t.slice(4,6),16)+", "+e+")"}return this.appLoginStyle.mainColor},initAppStyle(){if(this.isCustomized){let e=document.createElement("style");e.appendChild(document.createTextNode(".app-custom.only-one-tab .tab-label.active { color: transparent; }")),e.appendChild(document.createTextNode(`.app-custom .tab-label.active { color: ${this.calcMainColor()}; border-top-color: ${this.calcMainColor()}; }`)),e.appendChild(document.createTextNode(`.app-custom .tab-label:hover { color: ${this.calcMainColor()}; }`)),document.getElementsByTagName("head")[0].appendChild(e)}},setActiveTab(e){this.active=e,this.tabs.forEach((function(t,s){t.isActive=s===e,t.isActive&&(this.$store.commit("mainPage/updateActiveTabName",t.name),window.localStorage.setItem("login_type",t.name))}),this)},setActiveTabByName(e){this.tabs.forEach((function(t,s){t.name===e?(this.active=s,t.isActive=!0,this.$store.commit("mainPage/updateActiveTabName",t.name),window.localStorage.setItem("login_type",t.name)):t.isActive=!1}),this)},loadTabs(e="dsmTabPanel"){this.tabs=[],this.$children.forEach(e=>{this.tabs=this.tabs.concat(e.$children)});let t=window.localStorage.getItem("login_type");this.isSupportSSO&&this.$emit("do-sso-init"),this.activeTabName?this.setActiveTabByName(this.activeTabName):this.isSpecificAccount||!this.isSupportSSO||!_S("sso_default_login")&&"ssoTabPanel"!==t?this.isSupportOIDCSSO&&"oidcssoTabPanel"===t?this.setActiveTabByName("oidcssoTabPanel"):this.setActiveTabByName(e):this.setActiveTabByName("ssoTabPanel"),this.needReloadTabs=!1}}},m,[],!1,null,"67ab679f",null);w.options.__file="js/components/tabs.vue";var y=w.exports,P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tab",{staticClass:"dsm-login-panel-tab",attrs:{label:e.T("login","account_login"),name:"dsmTabPanel"}},[s("panel-title",{attrs:{"show-app-icon":e.showAppIcon,"show-app-title-img":e.showAppTitleImg,"show-username":"/signin"!==e.routePath}}),e._v(" "),s("transition",{attrs:{name:"quick-fade",mode:"out-in"}},[s("router-view",{staticClass:"login-content-section",attrs:{"route-prefix":"/signin"},on:{"do-login":e.onLogin,"go-desktop":e.onGoDesktop,spinning:e.onSpinning,"enable-bombing-on-done":e.onEnableBombingOnDone,"show-toast":e.onShowToast}})],1)],1)};P._withStripped=!0;var k={data:()=>({showAppIcon:!1,showAppTitleImg:!1}),created(){this.detectPanelTitleType()},methods:{detectPanelTitleType(){this.tpl.login_title===_S("hostname")&&this.hasTitleImgPath?this.showAppTitleImg=!0:this.showAppIcon=this.hasAppIconPath}},computed:{tpl(){return this.$store.state.mainPage.tpl},appLoginStyle(){return this.$store.state.mainPage.appLoginStyle},loginFieldsetCls:()=>({"login-fieldset":!0}),hasAppIconPath:()=>!!SYNO.SDS.Session.appIconPath,hasTitleImgPath(){return!!this.appLoginStyle.titleImgPath},mainColor(){if(this.appLoginStyle.mainColor)return this.appLoginStyle.mainColor},isPreview(){return this.$store.state.mainPage.tpl.preview},message(){return this.$store.state.mainPage.message},messageStyle(){return this.$store.state.mainPage.messageStyle},messageCls(){return"error"===this.messageStyle?"error":"info"},disableForm:{get(){return this.$store.state.mainPage.disableForm},set(e){this.$store.commit("mainPage/updateDisableForm",e)}}}},T=function(){var e=this.$createElement;return(this._self._c||e)("div",{directives:[{name:"show",rawName:"v-show",value:this.isActive,expression:"isActive"}],staticClass:"tab"},[this._t("default")],2)};T._withStripped=!0;var C=_({props:{title:{type:String,default:""},label:{type:String,default:""},name:{type:String,required:!0}},data:()=>({isActive:!1})},T,[],!1,null,null,null);C.options.__file="js/components/tab.vue";var $=C.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("transition",{attrs:{name:"quick-fade",mode:"out-in"}},[e.showUsername?s("user-avatar"):s("div",{class:e.loginTitleCls},[e.showAppTitleImg?s("img",{staticClass:"app-title",attrs:{src:e.imgPath,draggable:"false"}}):e._e(),e._v(" "),e.showAppIcon?s("img",{staticClass:"app-icon",attrs:{src:e.imgPath,draggable:"false"}}):e._e(),e._v(" "),e.showAppTitleImg?e._e():s("span",{directives:[{name:"login-tooltip",rawName:"v-login-tooltip.html",value:{content:e.hostname,overflowOnly:!0},expression:"{\n          content: hostname,\n          overflowOnly: true,\n        }",modifiers:{html:!0}}],domProps:{innerHTML:e._s(e.hostname)}})])],1)],1)};x._withStripped=!0;var O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"username-wrapper"},[s("div",{class:{"back-btn-wrapper":!0,"back-btn-wrapper--hide-back":e.isSpecificAccount},attrs:{role:"button",tabindex:"0"},on:{click:function(t){return t.preventDefault(),e.goBack(t)},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.goBack(t)}}},[s("div",{staticClass:"back-btn"}),e._v(" "),s("div",{class:e.avatarCls}),s("div",{staticClass:"username"},[e._v("\n      "+e._s(e.username)+"\n    ")])])])};O._withStripped=!0;var D=_({data:()=>({}),computed:{...Object(a.mapState)("mainPage",["isSpecificAccount"]),...Object(a.mapGetters)("mainPage",["username"]),avatarCls:()=>["avatar","avatar-none"]},methods:{goBack(){this.isSpecificAccount||(this.$store.commit("mainPage/enableSpinning",!1),this.$router.replace("/signup"))}}},O,[],!1,null,"2ac20b65",null);D.options.__file="js/components/userAvatar.vue";var L=D.exports,F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.showTooltip?s("div",{staticClass:"login-tooltip",style:e.tooltipStyle},[e.isHtml?e._e():s("span",[e._v(e._s(e.content))]),e._v(" "),e.isHtml?s("span",{domProps:{innerHTML:e._s(e.content)}}):e._e()]):e._e()};F._withStripped=!0;var A=_({props:{overflowOnly:{type:Boolean,default:!1},content:{type:String,default:""},isHtml:{type:Boolean,default:!1},delay:{type:Number,default:300}},data:()=>({x:0,y:0,opacity:0,showTooltip:!1,transitionTime:500}),computed:{tooltipStyle(){return{left:`${this.x}px`,top:`${this.y}px`,opacity:this.opacity,transition:`opacity ${this.transitionTime}ms`}}},methods:{show(e,t,s){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.overflowOnly&&e.offsetWidth>=e.scrollWidth||(this.showTooltip=!0,this.showTimeout=setTimeout(()=>{this.calcPosition(t,s),this.opacity=.8},this.delay))},hide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.opacity=0,this.hideTimeout=setTimeout(()=>{this.showTooltip=!1},this.transitionTime)},calcPosition(e,t){this.$el&&this.$el.offsetWidth&&e+this.$el.offsetWidth>=window.innerWidth?this.x=window.innerWidth-this.$el.offsetWidth:this.x=e+20,this.y=t+20}}},F,[],!1,null,null,null);A.options.__file="js/components/tooltip.vue";var N=A.exports,E=_({components:{"user-avatar":L},directives:{"login-tooltip":{bind(e,t){const s=o.a.extend(N);e._tooltip=new s({propsData:t.def.optionHandler(t)}),e._tooltip.$mount(),document.body.appendChild(e._tooltip.$el),e._tooltip_e_mousemove_cb=t=>{e._tooltip.show(t.currentTarget,t.clientX,t.clientY)},e._tooltip_e_mouseleave_cb=()=>{e._tooltip.hide()},e.addEventListener("mousemove",e._tooltip_e_mousemove_cb),e.addEventListener("mouseleave",e._tooltip_e_mouseleave_cb)},componentUpdated(e,t){t.def.updateHandler(e,t)},unbind(e){e.removeEventListener("mousemove",e._tooltip_e_mousemove_cb),e.removeEventListener("mouseleave",e._tooltip_e_mouseleave_cb),document.body.removeChild(e._tooltip.$el),e._tooltip.$destroy()},optionHandler(e){let t={};return"string"==typeof e.value?t.content=e.value:"object"==typeof e.value&&(t=e.value),t.isHtml=void 0!==e.modifiers.html&&e.modifiers.html,t},updateHandler(e,t){if(!e._tooltip)return;let s=t.def.optionHandler(t);for(const t in s)e._tooltip.$set(e._tooltip,t,s[t])}}},props:{showAppIcon:{type:Boolean,default:!1},showAppTitleImg:{type:Boolean,default:!1},showUsername:{type:Boolean,default:!1}},computed:{...Object(a.mapState)("mainPage",{username:e=>e.dsmForm.username}),...Object(a.mapGetters)("mainPage",["hostname"]),loginTitleCls(){let e={field:!0,"login-title":!0};return this.showAppIcon&&(e["login-title-icon"]=this.showAppIcon),this.showAppTitleImg&&(e["login-title-img"]=this.showAppTitleImg),e},imgPath(){let e="";if(this.showAppIcon)_S("appIconPath")&&(e=SYNO.SDS.UIFeatures.IconSizeManager.getAppPortalIconPath(_S("appIconPath")));else if(this.showAppTitleImg&&this.appLoginStyle.titleImgPath){let t=SYNO.SDS.UIFeatures.IconSizeManager.isRetinaMode();e=this.appLoginStyle.titleImgPath.replace("{0}",t?"2x":"1x")}return e},appLoginStyle(){return this.$store.state.mainPage.appLoginStyle},mainColor(){return this.appLoginStyle.mainColor?this.appLoginStyle.mainColor:""}},methods:{onClickBack(){this.$router.replace("/signup")}}},x,[],!1,null,null,null);E.options.__file="js/components/panelTitle.vue";var I=E.exports,M=_({components:{tab:$,"panel-title":I},mixins:[k,u],props:{disabled:Boolean},computed:{...Object(a.mapState)("mainPage",{username:e=>e.dsmForm.username}),routePath(){return this.$route.path}},methods:{onLogin(){this.$emit("do-login")},onEnableBombingOnDone(e){this.$emit("enable-bombing-on-done",e)},onSpinning(e){this.$emit("spinning",e)},onGoDesktop(e){this.$emit("go-desktop",e)},onShowToast(e,t){this.$emit("show-toast",e,t)}}},P,[],!1,null,null,null);M.options.__file="js/components/dsmLoginPanel.vue";var Y=M.exports,U=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isEnablebTab?s("tab",{attrs:{label:e.T("login","sso_login"),name:"ssoTabPanel"}},[s("panel-title",{attrs:{"show-app-icon":e.showAppIcon,"show-app-title-img":e.showAppTitleImg}}),e._v(" "),s("div",{class:e.loginFieldsetCls},[s("div",{staticClass:"tab-panel-title"},[e._v("\n      "+e._s(e.T("login","sso_login"))+"\n    ")]),e._v(" "),s("checkbox",{attrs:{label:e.T("login","rememberme"),disabled:e.disableInput},model:{value:e.stayLogin,callback:function(t){e.stayLogin=t},expression:"stayLogin"}})],1),e._v(" "),s("next-btn",{ref:"nextBtn",attrs:{"is-mobile":e.shouldUseMobileStyle,"syno-id":"sso-login-panel-next-btn"},on:{"btn-click":e.onLogin}}),e._v(" "),s("div",{staticClass:"login-remain-section"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.message,expression:"message"}],staticClass:"login-msg-box",class:[e.messageCls],domProps:{innerHTML:e._s(e.message)}})])],1):e._e()};U._withStripped=!0;var q={computed:{shouldUseMobileStyle:()=>_S("isMobileDevice")&&screen.width<520}},j=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-checkbox",class:e.fieldCls},[s("input",{ref:"input",attrs:{id:e._uid,type:"checkbox",autofocus:!!e.autofocus,disabled:e.disabled,tabindex:e.tabindex},domProps:{checked:e.value},on:{change:e.onChange,focus:e.onFocus,blur:e.onBlur}}),s("label",{staticClass:"box",attrs:{for:e._uid},on:{keydown:e.onLabelKeydown}}),s("label",{staticClass:"label",attrs:{for:e._uid}},[e._v(e._s(e.label))])])};j._withStripped=!0;var B=_({props:{value:Boolean,label:{type:String,default:""},autofocus:Boolean,disabled:{type:Boolean,default:!1},tabindex:{type:Number,default:0}},data:()=>({isFocused:{type:Boolean,default:!1}}),computed:{fieldCls(){return{checked:this.value,focused:this.isFocused,disabled:this.disabled}}},methods:{focus(){this.$refs.input.focus()},onFocus(e){this.isFocused=!0,this.$emit("focus",e)},onBlur(e){this.isFocused=!1,this.$emit("blur",e)},onChange(e){this.$emit("input",e.target.checked)},onLabelKeydown(e){switch(e.key){case"Enter":case" ":e.stopPropagation(),this.$refs.input.click()}}}},j,[],!1,null,null,null);B.options.__file="js/components/checkbox.vue";var H=B.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.show&&!e.isMobile?s("div",{class:e.btnCls,attrs:{role:"button",tabindex:e.innerTabIndex,"syno-id":e.synoId,"aria-label":e.T("login","sign_in")},on:{keyup:e.onKeyup,click:e.onClick}},[s("div",{staticClass:"login-btn-spinner-wrapper"},[s("spinner",{staticClass:"login-btn-spinner"})],1),e._v(" "),s("div",{staticClass:"login-btn-animation",class:e.pulseCls}),e._v(" "),s("div",{ref:"grow-bg",staticClass:"grow-bg"}),e._v(" "),s("div",{staticClass:"arrow"})]):e.show&&e.isMobile?s("div",{class:e.btnCls,attrs:{tabindex:e.innerTabIndex},on:{keyup:e.onKeyup,click:e.onClick}},[s("div",{staticClass:"login-btn-spinner-wrapper"},[s("spinner",{staticClass:"login-btn-spinner"})],1),e._v(" "),s("div",{staticClass:"btn-text"},[e._v("\n    "+e._s(e.btnText)+"\n  ")])]):e._e()};z._withStripped=!0;var R=_({components:{spinner:f},mixins:[u],props:{show:{type:Boolean,default:!0},tabindex:{type:Number,default:0},isMobile:{type:Boolean,default:!1},text:{type:String,default:""},synoId:{type:String,default:""}},data:()=>({disabled:!1,pulseActive:!0,spinActive:!1}),computed:{btnCls(){return{"login-btn":!this.isMobile,"login-btn-mobile":this.isMobile,"app-custom":this.isCustomized,disable:this.disabled,spin:this.spinActive}},pulseCls(){return{"animation-active":this.pulseActive}},isCustomized(){return this.appLoginStyle&&this.appLoginStyle.mainColor&&"#"===this.appLoginStyle.mainColor[0]},appLoginStyle(){return this.$store.state.mainPage.appLoginStyle},onLoginProcedure:{get(){return this.$store.state.mainPage.onLoginProcedure},set(e){this.$store.commit("mainPage/updateOnLoginProcedure",e)}},innerTabIndex(){return!0===this.disabled?-1:this.tabindex},btnText(){return this.text?this.text:this.T("login","next")}},watch:{onLoginProcedure(e){this.spin(e)}},created(){this.initAppStyle(),!0===_S("preview")&&this.disable()},mounted(){this.calcLoginBtnGrowSize(),this.initResizeListener()},beforeDestroy(){window.removeEventListener("resize",this.calcLoginBtnGrowSize)},methods:{disable(){this.disabled=!0,this.pulseActive=!1,this.spinActive=!1},enable(){this.disabled=!1,this.pulseActive=!0,this.spinActive=!1},pulse(e){this.disabled=!1,this.spinActive=!e,this.pulseActive=e},spin(e){this.spinActive=e,this.pulseActive=!e},calcMainColor(e){if(e){let t=this.appLoginStyle.mainColor.replace("#","");return"rgba("+parseInt(3==t.length?t.slice(0,1).repeat(2):t.slice(0,2),16)+", "+parseInt(3==t.length?t.slice(1,2).repeat(2):t.slice(2,4),16)+", "+parseInt(3==t.length?t.slice(2,3).repeat(2):t.slice(4,6),16)+", "+e+")"}return this.appLoginStyle.mainColor},initAppStyle(){if(this.isCustomized){let e=document.createElement("style");e.appendChild(document.createTextNode(`.app-custom.login-btn { background-color: ${this.calcMainColor()};box-shadow: 0 5px 14px 0 ${this.calcMainColor(.34)}; }`)),e.appendChild(document.createTextNode(`.app-custom.login-btn .login-btn-animation { background-color: ${this.calcMainColor(.5)}; }`)),e.appendChild(document.createTextNode(`.app-custom.login-btn-mobile { background-color: ${this.calcMainColor()}; }`)),e.appendChild(document.createTextNode(`.app-custom.login-btn .grow-bg { background-color: ${this.calcMainColor()}; }`)),document.getElementsByTagName("head")[0].appendChild(e)}},onKeyup(e){"Enter"!==e.code&&"Space"!==e.code||this.onClick()},onClick(){this.disabled||this.$emit("btn-click")},calcLoginBtnGrowSize(){let e=this.$refs["grow-bg"],t=Math.max(document.body.offsetHeight,document.body.offsetWidth)/36*2,s=1/t;e&&(e.style.height=36*t+"px",e.style.width=36*t+"px",e.style.top=-36*t/2+36+"px",e.style.left=-36*t/2+36+"px",e.style.transform="scale("+s+")")},initResizeListener:function(){window.addEventListener("resize",this.calcLoginBtnGrowSize)}}},z,[],!1,null,null,null);R.options.__file="js/components/nextButton.vue";var G=R.exports,W=_({components:{tab:$,"panel-title":I,checkbox:H,"next-btn":G},mixins:[k,q,u],props:{disabled:Boolean},data:()=>({isActive:!1}),computed:{disableInput(){return this.isPreview||this.disabled},isEnablebTab(){return!!this.isSupportSSO},isSupportSSO(){return this.$store.state.mainPage.isSupportSSO},stayLogin:{get(){return this.$store.state.mainPage.stayLogin},set(e){this.$store.commit("mainPage/updateStayLogin",e)}}},beforeMount:function(){this.stayLogin="1"===SYNO.SDS.GetCookieByName("stay_login")},methods:{onLogin(){this.$emit("do-login")}}},U,[],!1,null,null,null);W.options.__file="js/components/ssoLoginPanel.vue";var V=W.exports,K=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isEnablebTab?s("tab",{attrs:{label:e.title,name:"oidcssoTabPanel"}},[s("panel-title",{attrs:{"show-app-icon":e.showAppIcon,"show-app-title-img":e.showAppTitleImg}}),e._v(" "),s("div",{class:e.loginFieldsetCls},[s("div",{staticClass:"tab-panel-title"},[e._v("\n      "+e._s(e.title)+"\n    ")]),e._v(" "),s("checkbox",{attrs:{label:e.T("login","rememberme"),disabled:e.disableInput},model:{value:e.stayLogin,callback:function(t){e.stayLogin=t},expression:"stayLogin"}})],1),e._v(" "),s("next-btn",{ref:"nextBtn",attrs:{"is-mobile":e.shouldUseMobileStyle,"syno-id":"oidc-login-panel-next-btn"},on:{"btn-click":e.onLogin}}),e._v(" "),s("div",{staticClass:"login-remain-section"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.message,expression:"message"}],staticClass:"login-msg-box",class:[e.messageCls],domProps:{innerHTML:e._s(e.message)}})])],1):e._e()};K._withStripped=!0;var J=_({components:{tab:$,"panel-title":I,checkbox:H,"next-btn":G},mixins:[k,q,u],props:{disabled:Boolean},data(){return{isActive:!1,title:"oidc"==_S("oidc_sso_profile")?_S("oidc_name")+" "+this.T("sso","sso_login"):this.T("login",_S("oidc_sso_profile")+"_sso_login")}},computed:{disableInput(){return this.isPreview||this.disabled},isEnablebTab(){return!!this.isSupportOIDCSSO},isSupportOIDCSSO(){return this.$store.state.mainPage.isSupportOIDCSSO},stayLogin:{get(){return this.$store.state.mainPage.stayLogin},set(e){this.$store.commit("mainPage/updateStayLogin",e)}}},beforeMount:function(){this.stayLogin="1"===SYNO.SDS.GetCookieByName("stay_login")},methods:{onLogin(){this.$emit("do-login")}}},K,[],!1,null,null,null);J.options.__file="js/components/oidcssoLoginPanel.vue";var X=J.exports,Q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-preview-container"},[s("div",{staticClass:"login-preview-bar"},[s("span",{staticClass:"information"},[e._v(e._s(e.T("login","login_apply_preview")))]),e._v(" "),s("div",{staticClass:"preview-btnset"},[s("v-button",{attrs:{"syno-id":"components-preview-bar-button-0",suffix:"grey",type:"footbar"},on:{click:e.onCancel}},[e._v("\n        "+e._s(e.T("login","cancel"))+"\n      ")]),e._v(" "),s("v-button",{attrs:{"syno-id":"components-preview-bar-button-1",suffix:"blue",type:"footbar"},on:{click:e.onApply}},[e._v("\n        "+e._s(e.T("login","apply"))+"\n      ")])],1)])])};Q._withStripped=!0;var Z=_({mixins:[u],created(){this.initSynotoken()},methods:{onApply(){let e=window.location.origin;e||(e=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),opener&&opener.postMessage({action:"save",origin:e},e),window.close()},onCancel(){window.close()},initSynotoken(){if(_S&&_S("SynoToken")){let e=SYNO.SDS.Utils.GetURLParam(location.search.substr(1));e.SynoToken&&(SYNO.SDS.Session.SynoToken=e.SynoToken,synowebapi&&synowebapi.env.setSynoToken(SYNO.SDS.Session.SynoToken))}}}},Q,[],!1,null,null,null);Z.options.__file="js/components/previewBar.vue";var ee=Z.exports,te=function(){var e=this.$createElement,t=this._self._c||e;return!0===this.tpl.logo_enable?t("div",{staticClass:"login-logo"},[t("img",{staticStyle:{position:"relative",width:"auto",height:"100%"},attrs:{src:this.logoPath,draggable:"false"}})]):this._e()};te._withStripped=!0;var se=_({props:{tpl:{type:Object,default:()=>({})}},data:()=>({}),computed:{logoPath(){let e="";return this.tpl.logo_enable&&(e=this.tpl.logo_path),e}}},te,[],!1,null,null,null);se.options.__file="js/components/logo.vue";var ie=se.exports,oe=function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("message-title",{attrs:{title:this.tpl.login_welcome_title}}),this._v(" "),t("message-desc",{attrs:{desc:this.tpl.login_welcome_msg}})],1)};oe._withStripped=!0;var ae=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"login-msg-title",domProps:{innerHTML:this._s(this.escapedTitle)}})};ae._withStripped=!0;var ne=_({props:{title:{type:String,default:""}},computed:{escapedTitle(){return this.title.replace(/&nbsp;/g," ")}}},ae,[],!1,null,null,null);ne.options.__file="js/components/messageTitle.vue";var re=ne.exports,le=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"login-msg-desc",domProps:{innerHTML:this._s(this.escapedDesc)}})};le._withStripped=!0;var ce=_({props:{desc:{type:String,default:""}},computed:{escapedDesc(){return this.desc.replace(/&nbsp;/g," ")}}},le,[],!1,null,null,null);ce.options.__file="js/components/messageDesc.vue";var pe=_({components:{"message-title":re,"message-desc":ce.exports},props:{tpl:{type:Object,default:()=>({})}},data:()=>({})},oe,[],!1,null,null,null);pe.options.__file="js/components/message.vue";var de=pe.exports,ue=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"toast-container"},[t("div",{ref:"content",staticClass:"toast-bar"},[this.show&&!this.isVueContent?t("span",{staticClass:"toast-content",domProps:{innerHTML:this._s(this.content)}}):this._e()])])};ue._withStripped=!0;var he=_({data:()=>({show:!1,isVueContent:!1,content:null}),methods:{showToast(e){null!==this.content&&this.reset(),this.content=e,e._isVue&&(this.isVueContent=!0,this.mountVueContent(this.content)),this.show=!0},hideToast(){this.show=!1,this.reset()},reset(){null!==this.content&&(this.content._isVue&&(this.content.$el.remove(),this.content.$destroy()),this.isVueContent=!1,this.content=null)},mountVueContent(e){let t=document.createElement("div");this.$refs.content.appendChild(t),e.$mount(t)}}},ue,[],!1,null,"0ae57dd6",null);he.options.__file="js/components/toast.vue";var me=he.exports,ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"footer"},[s("div",{ref:"boxWrapper",staticClass:"box-wrapper"},[s("div",{ref:"box",class:e.boxClasses,on:{mouseenter:e.expand,mouseleave:e.collapse}},[e.isHtml?s("div",{ref:"msg",staticClass:"msg",domProps:{innerHTML:e._s(e.text)}}):s("div",{ref:"msg",staticClass:"msg",domProps:{textContent:e._s(e.text)}})])])])};ge._withStripped=!0;const _e=(e,t=250)=>{let s;return function(...i){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e.apply(this,i)},t)}};var ve=_({mounted(){this.updateExpandable(),this.unlistener=this.listenWindowReisze()},beforeDestroy(){this.unlistener()},data(){return{isPreview:!1,isHtml:void 0!==SYNO.SDS.Session.login_footer_enable_html&&SYNO.SDS.Session.login_footer_enable_html,text:this.decodeHTML(SYNO.SDS.Session.login_footer_msg),minHeight:void 0,expandable:!1,expanded:!1}},computed:{boxClasses(){return{box:!0,expandable:this.expandable,expanded:this.expanded}}},created(){_S("preview")&&window.opener&&window.opener.previewParam&&void 0!==window.opener.previewParam.login_footer_enable_html&&void 0!==window.opener.previewParam.login_footer_msg&&(this.isHtml=window.opener.previewParam.login_footer_enable_html,this.text=this.decodeHTML(window.opener.previewParam.login_footer_msg))},methods:{decodeHTML(e){if(void 0===e)return"";let t=document.createElement("textarea");return t.innerHTML=e.replace(/&nbsp;/g," "),t.value},async updateExpandable(){await this.$nextTick(),this.$refs.msg&&(this.expandable=this.$refs.msg.offsetHeight<this.$refs.msg.scrollHeight,this.minHeight=Math.min(this.$refs.boxWrapper.offsetHeight,57)+"px",this.$refs.box.style.maxHeight=this.minHeight)},expand(){this.expandable&&(this.$refs.box.style.maxHeight=`${this.$refs.msg.scrollHeight+24}px`,this.expanded=!0)},collapse(){this.expandable&&(this.$refs.box.style.maxHeight=this.minHeight,this.expanded=!1)},listenWindowReisze(){const e=_e((function(){this.updateExpandable()}),250).bind(this);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}}},ge,[],!1,null,"79fcd608",null);ve.options.__file="js/components/footer.vue";var fe=ve.exports,be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"personal-updater-wrapper"},[s("div",{staticClass:"personal-updater-container"},[s("v-spin",{staticClass:"loader",attrs:{type:"large-dots"}}),e._v(" "),s("div",{staticClass:"text title"},[e._v(e._s(e.$i18n("personal_updater","title"))+"("+e._s(e.progress)+"%)")]),e._v(" "),s("div",{staticClass:"text desc"},[e._v(e._s(e.description))])],1)])};be._withStripped=!0;var Se=function(){var e=this.$createElement;this._self._c;return this._m(0)};Se._withStripped=!0;var we=_({},Se,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login-upgrade-loader"},[t("div",{staticClass:"login-upgrade-loader-dots"})])}],!1,null,null,null);we.options.__file="js/components/loader.vue";var ye=we.exports;var Pe=_({components:{loader:ye},mixins:[u],inject:{gotoDesktop:{default:()=>{}}},data(){return{goDesktop:!1,description:this.$i18n("personal_updater","desc"),currentSession:{},task:{updater:{done:!1,totalJobs:0,finishedJobs:0},promotionData:{done:!1,totalJobs:0,finishedJobs:0}}}},computed:{progress(){let e=0,t=0;for(const s of Object.keys(this.task))e+=this.task[s].totalJobs,t+=this.task[s].finishedJobs;return 0===e?0:Math.floor(100*t/e)},readyToGoDesktop(){for(const e of Object.keys(this.task))if(!this.task[e].done)return!1;return!0}},watch:{readyToGoDesktop(e){e&&this.gotoDesktop()}},created(){},async mounted(){await this.getUserService(),this.$options.updateTimeout=window.setTimeout(()=>{this.description=this.$i18n("personal_updater","desc_when_delay"),this.getUpdateProgress()},6e4),this.registerSocket(),this.startUpdate(),this.prefetchPromotionData()},beforeDestroy(){this.$options.updateTimeout&&window.clearTimeout(this.$options.updateTimeout),this.unregisterSocket()},methods:{registerSocket(){let e=!!this.currentSession.rewriteApp;this.$options.socket=new SYNO.SDS.Socket({standaloneMode:!!e}),this.$options.socket.registerWebAPIEvent({api:"SYNO.Core.Desktop.PersonalUpdater",version:1,method:"get_update_progress"},e=>{this.handleUpdateProgress(e.data)},!0)},async prefetchPromotionData(){Ext.namespace("SYNO.SDS.App.PromotionApp.PrefetchedData");const e=[synowebapi.promises.request({api:"SYNO.Core.MyDSCenter",version:2,method:"query"}).then(({is_logged_in:e})=>SYNO.SDS.App.PromotionApp.PrefetchedData.isSALoggedin=e).catch(e=>{e&&3002===e.code?SYNO.SDS.App.PromotionApp.PrefetchedData.isSALoggedin=!0:SYNO.SDS.App.PromotionApp.PrefetchedData.isSALoggedin=!1}).finally(()=>this.task.promotionData.finishedJobs+=1),synowebapi.promises.request({api:"SYNO.ActiveInsight.Package",version:2,method:"get_status"}).then(({enabled:e})=>SYNO.SDS.App.PromotionApp.PrefetchedData.isAIEnabled=e).finally(()=>this.task.promotionData.finishedJobs+=1)];e.push(synowebapi.promises.request({api:"SYNO.Core.EW.Info",method:"get",version:1,params:{use_extended_cache:!0}}).then(({info:e,mail:t,show_welcome_page:s})=>{SYNO.SDS.App.PromotionApp.PrefetchedData.ewInfo={email:t,sn:e.sn,eligible:s,eventUntil:e.promotion_expired_at,advertisement:e.advertisement}}).finally(()=>this.task.promotionData.finishedJobs+=1)),this.task.promotionData.totalJobs+=e.length,Promise.all(e).finally(()=>this.task.promotionData.done=!0)},async getUserService(){const e=new URLSearchParams(window.location.search);try{const t=await synowebapi.promises.request({api:"SYNO.Core.Desktop.Initdata",method:"get_user_service",version:1,params:{launchApp:e.get("launchApp"),action:e.has("jsDebug")?"debug":null}});this.currentSession=t.Session}catch(e){SYNO.Debug.error(e)}},handleUpdateProgress(e){e&&(this.task.updater.totalJobs=e.total_job_count,this.task.updater.finishedJobs=e.jobs_list,e.finished&&(this.task.updater.done=!0))},unregisterSocket(){this.$options.socket&&this.$options.socket.disconnect(),this.$options.socket=null},async getUpdateProgress(){try{const e=await synowebapi.promises.request({api:"SYNO.Core.Desktop.PersonalUpdater",method:"get_update_progress",version:1});this.handleUpdateProgress(e)}catch(e){this.task.updater.done=!0}},async startUpdate(){try{(await synowebapi.promises.request({api:"SYNO.Core.Desktop.PersonalUpdater",method:"start",version:1})).need_update||(this.task.updater.done=!0)}catch(e){this.task.updater.done=!0}}}},be,[],!1,null,null,null);function ke(){}Pe.options.__file="js/components/personalUpdater.vue";var Te=_({components:{"preview-bar":ee,toast:me,logo:ie,message:de,"dsm-tab-panel":Y,"sso-tab-panel":V,"oidc-sso-tab-panel":X,tabs:y,"footer-msg":fe,"personal-updater":Pe.exports},mixins:[h,u],inject:{gotoDesktop:{default:ke},setSynoToken:{default:ke}},data:()=>({iframe:{},isDisabled:!1,isPreview:!1,showPreviewBar:!1,backgroundTpl:{},toastTimeoutId:null}),computed:{...Object(a.mapGetters)("mainPage",["enabledAuthList"]),...Object(a.mapState)("mainPage",["isNeedPersonalUpdater"]),wrapperCls(){return{disable:this.disableForm,"login-mobile":this.isMobileDevice,"syno-cjk":this.isCJK}},tpl(){return this.$store.state.mainPage.tpl},trustDevice(){return this.$store.state.mainPage.trustDevice},activeTabName(){return this.$store.state.mainPage.activeTabName},requestPassword(){return this.isUseSSO?this.SSOToken:this.password},isSupportSSO(){return this.$store.state.mainPage.isSupportSSO},isLoginable(){return!this.disableForm},isMobileDevice:()=>!!_S("isMobileDevice")&&_S("isMobileDevice"),isCJK(){let e=new Set(["cht","chs","jpn","krn"]);return!(!SYNO.SDS.Session||!SYNO.SDS.Session.lang)&&e.has(SYNO.SDS.Session.lang)},OTPcode:{get(){return this.$store.state.mainPage.dsmForm.OTPcode},set(e){this.$store.commit("mainPage/updateDsmOTPcode",e)}},username:{get(){return this.$store.state.mainPage.dsmForm.username},set(e){this.$store.commit("mainPage/updateDsmUsername",e)}},password:{get(){return this.$store.state.mainPage.dsmForm.password},set(e){this.$store.commit("mainPage/updateDsmPassword",e)}},stayLogin:{get(){return this.$store.state.mainPage.stayLogin},set(e){this.$store.commit("mainPage/updateStayLogin",e)}},disableForm:{get(){return this.$store.state.mainPage.disableForm},set(e){this.$store.commit("mainPage/updateDisableForm",e)}},onLoginProcedure:{get(){return this.$store.state.mainPage.onLoginProcedure},set(e){this.$store.commit("mainPage/updateOnLoginProcedure",e)}},isUseSSO:{get(){return this.$store.state.mainPage.isUseSSO},set(e){this.$store.commit("mainPage/updateIsUseSSO",e)}},oidcEnable:{get(){return this.$store.state.mainPage.oidc.enable},set(e){this.$store.commit("mainPage/updateOidcEnable",e)}},oidcParams:{get(){return this.$store.state.mainPage.oidc.params},set(e){this.$store.commit("mainPage/updateOidcParams",e)}}},created:function(){this.initPreview(),this.$store.dispatch("mainPage/updateTpl",this.isPreview),this.$store.dispatch("mainPage/updateAppLoginStyle")},mounted:function(){this.initLoginBackground(),this.initResizeListener(),this.showIE11WarningToastIfNeeded(),this.showErrorIfNeeded(),this.setHtmlLang()},beforeDestroy:function(){this.backgroundTpl.$destroy(),window.removeEventListener("resize",this.backgroundResizer)},methods:{...Object(a.mapActions)("mainPage",["setAuthList","setNeed2FA","needPersonalUpdate"]),initPreview:function(){this.isPreview=_S("preview"),this.isPreview&&window.opener&&window.opener.previewParam&&window.opener.previewParam.preview_modified&&(this.showPreviewBar=!0)},initResizeListener:function(){window.addEventListener("resize",this.backgroundResizer)},initLoginBackground:function(){if(this.backgroundTpl=new SYNO.SDS.BackgroundTpl({el:"#sds-login-wallpaper"}),this.tpl){let{width:e,height:t}=this.getLoginPageSize();this.backgroundTpl.setConfig({winW:e,winH:t,type:this.tpl.background_pos,imgSrc:this.tpl.background_path,bgColor:this.tpl.background_color}),this.tpl.background_width&&0<this.tpl.background_width&&this.tpl.background_height&&0<this.tpl.background_height&&this.backgroundTpl.setImgSize(this.tpl.background_width,this.tpl.background_height)}},backgroundResizer:function(){let{width:e,height:t}=this.getLoginPageSize();this.backgroundTpl.setConfig({winW:e,winH:t})},onShowToast:function(e,t){null!==this.toastTimeoutId&&window.clearTimeout(this.toastTimeoutId),this.$refs.toast.showToast(e),this.toastTimeoutId=window.setTimeout(()=>{this.$refs.toast.hideToast(),this.toastTimeoutId=null},t)},onSynologySSOInit:function(){SYNO.SDS.SSOUtils.init((function(){}),this)},onLoginSubmit:function(){this.removeBrowserVisibility(),this.$store.dispatch("mainPage/clearMessage"),"ssoTabPanel"===this.activeTabName||"oidcssoTabPanel"===this.activeTabName?this.onSSOLoginSubmit():this.startLoginProcedure()},sendLoginRequest:function(){var e=this.oidcIsUse&&Object.keys(this.oidcParams).length?this.oidcParams:{account:this.username,passwd:this.requestPassword,logintype:"local",otp_code:this.OTPcode,enable_device_token:this.trustDevice?"yes":"no",timezone:this.stdTimezone()};e.rememberme=this.stayLogin?1:0;var t=new Date;t.setDate(t.getDate()+60),SYNO.SDS.SetCookie("stay_login",this.stayLogin?1:0,t);let s={url:"webapi/entry.cgi?api=SYNO.API.Auth",requestFormat:"raw",responseFormat:"raw",method:"POST",callback:this.loginCallback,scope:this};synowebapi.env.isSecure()?synowebapi.request(Object.assign(s,{params:SYNO.SDS.HandShake.GetLoginParams(e)})):synowebapi.promises.encrypt(e,{requestFormat:"raw"}).then(e=>{synowebapi.request(Object.assign(s,{params:SYNO.SDS.HandShake.GetLoginParams(e)}))}).catch(()=>{let t=t=>{let i=!0;t&&(i=window.confirm(this.T("login","error_key_invalid"))),!1===i?this.stopLoginProcedure():synowebapi.request(Object.assign(s,{params:SYNO.SDS.HandShake.GetLoginParams(e)}))};synowebapi.promises.request({url:"webman/pingpong.cgi",timeout:3e3}).then(()=>{t(!0)}).catch(()=>{t(!1)})})},loginCallback:function(e,t){if(this.isUseSSO=!1,this.oidcIsUse=!1,this.oidcParams={},!0===t.success){let e=SYNO.SDS.HandShake.GetLoginSynoToken(t);this.readyToGoDesktop({synotoken:e})}else{let e=!1;if(this.stopLoginProcedure(),t.error&&t.error.code)switch(t.error.code){case 400:this.handleError("error_cantlogin"),e=!0;break;case 403:if(this.setNeed2FA(!0),t.error.errors&&t.error.errors.types){t.error.errors.token&&(this.password=t.error.errors.token);let e=t.error.errors.types.filter(e=>void 0!==e.type);this.setAuthList(e),this.$router.replace({path:this.getPrefer2FAEntry(e)})}else this.$router.replace({path:"/signin/otp"});break;case 404:this.OTPcode="",this.handleError("error_otp_failed");break;case 406:_S("isMobileDevice")?this.handleError("error_not_support_2fa_in_mobile"):(t.error.errors&&t.error.errors.token&&(this.password=t.error.errors.token),SYNO.SDS.Session.is_admin=t.error.errors.is_admin,this.$router.push({path:"/enforce-2fa-wizard"}));break;case 401:this.handleError("error_expired"),e=!0;break;case 408:this.handleError("error_pwd_expired");break;case 407:this.handleError("error_max_tries");break;case 409:case 410:if(t.external_url){var s=this.urlAppend(t.external_url,this.urlEncode({callback_url:window.location.href}));window.location.href=s}else"error_pwd_expired"===t.reason?this.$router.push({path:"/expired-pwd"}):this.$router.push({path:"/change-pwd"});break;case 412:this.handleError("error_guest");break;case 413:this.$store.dispatch("mainPage/setErrorMessage",String.format(this.T("login","error_corrupted_system_files"),'<a href="https://sy.to/resetnas" target="_blank">',"</a>")),this.stopLoginProcedure();break;case 402:this.handleError("error_noprivilege"),e=!0;break;case 499:this.handleError("error_system_not_ready");break;case 498:this.handleError("error_upgrading");break;default:this.handleError("error_unknown_error")}else this.handleError("error_unknown_error");e&&"dsmTabPanel"===this.activeTabName&&(this.$store.dispatch("mainPage/switchToTab","dsmTabPanel"),this.password="")}},async readyToGoDesktop({synotoken:e}){this.setSynoToken(e),await this.needPersonalUpdate(),this.isNeedPersonalUpdater||this.gotoDesktop(e)},onSpinning(e){this.$store.commit("mainPage/enableSpinning",e)},onEnableBombingOnDone(e){this.$store.commit("mainPage/enableBombingOnDone",e)},handleError:function(e){e&&e.length>0?this.$store.dispatch("mainPage/setErrorMessage",this.T("login",e)):this.$store.dispatch("mainPage/setErrorMessage",String.format(this.T("login","error_unexpected_login"),'<a href="https://www.synology.com/company/contact_us" target="_blank">',"</a>")),this.stopLoginProcedure()},stdTimezone:function(){var e=(new Date).getFullYear(),t=new Date(e,0,1).getTimezoneOffset(),s=new Date(e,6,1).getTimezoneOffset(),i=t>=s?t:s;return(i>0?"-":"+")+(""+Math.abs(i/60)).padStart(2,"0")+":"+(""+Math.abs(i%60)).padStart(2,"0")},urlAppend:function(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+t:e},urlEncode:function(e){var t=[];for(var s in e)t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")},startLoginProcedure(){!0===this.isLoginable&&(this.$store.dispatch("mainPage/clearMessage"),this.disableFormSubmit(),this.playLoginingAnimation(),this.sendLoginRequest())},stopLoginProcedure(){this.enableFormSubmit(),this.stopLoginingAnimation()},disableFormSubmit(){this.disableForm=!0,"activeElement"in document&&document.activeElement.blur(),this.$refs.tabs&&(this.$refs.tabs.loginBtnEnable=!1)},enableFormSubmit(){this.disableForm=!1,this.$refs.tabs&&(this.$refs.tabs.loginBtnEnable=!0)},playLoginingAnimation(){this.onLoginProcedure=!0},stopLoginingAnimation(){this.onLoginProcedure=!1},getPrefer2FAEntry(e){let t="/signin/otp",s=SYNO.SDS.PreferAuthType.Get(this.username)||"otp",i=e.map(e=>e.type);if(!i.includes(s)){if(i.includes("otp"))return t;if(0==i.length)return SYNO.Debug.error("No any 2FA entry exist."),t;s=i[0]}let o=SYNO.SDS.LoginPlugins.getPlugin(s);return void 0!==o&&(o.entry?t=SYNO.SDS.LoginPlugins.getPlugin(s).entry:SYNO.Debug.error(`Plugin ${s} entry not exist.`)),t},getLoginPageSize:()=>({width:document.getElementById("sds-login-vue-inst").scrollWidth,height:document.getElementById("sds-login-vue-inst").scrollHeight}),onVisibilityChange(){"visible"===document.visibilityState&&synowebapi.request({api:"SYNO.API.Auth",method:"token",version:6,scope:this,callback(e,t){e&&window.location.reload(!0)}})},addBrowserVisibility(){document.addEventListener("visibilitychange",this.onVisibilityChange)},removeBrowserVisibility(){document.removeEventListener("visibilitychange",this.onVisibilityChange)},showErrorIfNeeded(){if(window.sessionStorage){const e=window.sessionStorage.getItem("errCode");e&&(this.addBrowserVisibility(),this.$refs.toast.showToast(SYNO.API.Errors.common[e]),window.onbeforeunload=function(){window.sessionStorage.removeItem("errCode")})}},showIE11WarningToastIfNeeded(){Ext.isIE11&&this.showIE11WarningToast()},showIE11WarningToast(){const e=new Vue({template:`\n          <div style="margin-right: 0;" class="toast-content">\n            <span style="margin-right: 20px; display: inline-block;">${this.T("login","no_support_ie_browser")}</span>\n            <v-button syno-id="syno-ie-11-warning-toast-btn" type="footbar" style="color: inherit;" @click="onClick">${this.T("common","ok")}</v-button>\n          </div>\n        `,methods:{onClick:()=>{this.$refs.toast.hideToast()}}});this.$refs.toast.showToast(e)},setHtmlLang(){let e;const t=document.documentElement;switch(SYNO.SDS.Session&&SYNO.SDS.Session.lang&&(e=SYNO.SDS.Session.lang),e){case"cht":t.setAttribute("lang","zh-TW");break;case"chs":t.setAttribute("lang","zh-CN");break;case"jpn":t.setAttribute("lang","ja");break;case"krn":t.setAttribute("lang","ko")}}}},d,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login-wallpaper"},[t("div",{attrs:{id:"sds-login-wallpaper"}})])}],!1,null,null,null);Te.options.__file="js/pages/mainPage.vue";var Ce=Te.exports,$e=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login-page-common-layout-container login-page-forgot-pwd"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t(this.step,{tag:"component",on:{"sent-mail":this.onSentMail}})],1)],1)};$e._withStripped=!0;var xe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-enter-account login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("login","forgot_form_title"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc"},[e._v("\n          "+e._s(e.T("login","forgot_form_desc"))+"\n        ")])])]),e._v(" "),s("div",{staticClass:"area-center"},[s("div",{staticClass:"common-simple-form"},[s("textfield",{ref:"account",attrs:{type:"text",placeholder:e.T("login","forget_pass_user_name")},on:{submit:e.onSubmit},model:{value:e.account,callback:function(t){e.account=t},expression:"account"}}),e._v(" "),s("login-button",{attrs:{disabled:0==e.account.length,spin:e.loading},on:{click:e.onSubmit}},[e._v("\n          "+e._s(e.T("login","send_mail"))+"\n        ")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.msgShow,expression:"msgShow"}],staticClass:"msg",class:e.msgCls},[s("div",{staticClass:"text",domProps:{innerHTML:e._s(e.msgText)}})]),e._v(" "),s("div",{staticClass:"admin-hint"},[s("div",{staticClass:"text",domProps:{innerHTML:e._s(e.adminHint)}})])],1)]),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};xe._withStripped=!0;var Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-textfield-wrapper"},[s("div",{staticClass:"login-textfield",class:{error:e.error}},[s("span",{class:e.icon,style:e.iconStyles}),e._v(" "),s("div",{staticClass:"input-container"},[s("input",{ref:"input",class:{"has-after-input":e.$slots["after-input"]},attrs:{"syno-id":e.synoId,type:e.type,placeholder:e.placeholder,enterkeyhint:e.enterkeyhint,autofocus:!!e.autofocus,name:e.autofillname,autocomplete:"off",disabled:e.disabled,tabindex:e.tabindex},domProps:{value:e.value},on:{focus:e.onFocus,input:e.onInput,keydown:e.onKeydown}}),e._v(" "),e._t("after-input")],2),e._v(" "),s("div",{staticClass:"border active-border",style:{background:e.bordercolor}}),e._v(" "),s("div",{staticClass:"border bottom-border"}),e._v(" "),s("div",{staticClass:"border error-border"})]),e._v(" "),e.withStrength?s("div",{directives:[{name:"show",rawName:"v-show",value:e.passwordStrenghLevel>-1,expression:"passwordStrenghLevel > -1"}],class:[{"login-password-strength":!0},{weak:0===e.passwordStrenghLevel},{medium:1===e.passwordStrenghLevel},{strong:2===e.passwordStrenghLevel}]},[s("div",{staticClass:"strength-block block-1"}),e._v(" "),s("div",{staticClass:"strength-block block-2"}),e._v(" "),s("div",{staticClass:"strength-block block-3"}),e._v(" "),s("span",[e._v(e._s(e.passwordStrengthText))])]):e._e()])};Oe._withStripped=!0;var De=_({props:{value:{type:String,default:""},enterkeyhint:{type:String,default:""},type:{type:String,default:""},icon:{type:Object,default:()=>({})},iconUri:{type:String,default:""},placeholder:{type:String,default:""},autofocus:Boolean,bordercolor:{type:String,default:""},autofillname:{type:String,default:""},disabled:{type:Boolean,default:!1},tabindex:{type:Number,default:0},synoId:{type:String,default:""},withStrength:{type:Boolean,default:!1}},data:()=>({error:!1,passwordStrenghLevel:-1}),computed:{iconStyles(){let e={};return this.iconUri&&(e.backgroundImage="url("+this.iconUri+")"),e},passwordStrengthText(){const e=[_T("welcome","passwd_weak"),_T("welcome","passwd_medium"),_T("welcome","passwd_strong")];return this.passwordStrenghLevel<0||e.length<=this.passwordStrenghLevel?"":e[this.passwordStrenghLevel]}},watch:{value:((e,t=250)=>{let s;return function(...i){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e.apply(this,i)},t)}})((function(e=""){this.validate(),this.checkPasswordStrength()}),250)},methods:{onFocus(e){this.$emit("focus",e)},onInput(e){this.$emit("input",e.target.value)},onKeydown(e){"Enter"===e.key&&this.$emit("submit")},focus(){this.$refs.input.focus()},validate(){if(void 0!==this.value)return"password"===this.type||(this.error=!this.value,!this.error)},async checkPasswordStrength(){"password"===this.type&&this.withStrength&&(this.passwordStrenghLevel=await this.getPasswordStrengthLevel(this.value))},async getPasswordStrengthLevel(e=""){const{score:t}=await synowebapi.promises.request({api:"SYNO.Core.User.PasswordMeter",method:"evaluate",version:"1",encryption:["password"],params:{password:e}});return Math.floor(t/2)}}},Oe,[],!1,null,null,null);De.options.__file="js/components/textfield.vue";var Le=De.exports,Fe=function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"login-button",class:this.buttonClass,attrs:{type:"button"},on:{click:this.onClick}},[t("transition",{attrs:{name:"fade"}},[this.spin?t("spinner",{staticClass:"login-spinner"}):t("span",{staticClass:"text"},[this._t("default")],2)],1),this._v(" "),t("span",{staticClass:"invisible"},[this._t("default")],2)],1)};Fe._withStripped=!0;var Ae=_({components:{Spinner:f},props:{disabled:Boolean,color:{type:String,default:"blue"},size:{type:String,default:""},spin:{type:Boolean,default:!1}},computed:{buttonClass(){return[{[`login-button-${this.color}`]:this.color},{[`login-button-${this.size}`]:this.size},{disable:this.disabled},{spin:this.spin}]}},methods:{onClick(e){this.disabled||this.spin||this.$emit("click",e)}}},Fe,[],!1,null,null,null);Ae.options.__file="js/components/loginButton.vue";var Ne=Ae.exports,Ee=_({components:{textfield:Le,"login-button":Ne},mixins:[u],data:()=>({loading:!1,account:"",msgText:"",msgCls:"",msgShow:!1}),computed:{...Object(a.mapGetters)("mainPage",["username"]),adminHint(){let e="";return this.T("login","admin_hint")&&(e=this.T("login","admin_hint"),e=e.replace("{0}",'<a href="https://www.synology.com/knowledgebase/DSM/tutorial/General_Setup/How_do_I_log_in_if_I_forgot_the_admin_password" target="_blank">'),e=e.replace("{1}","</a>")),e}},beforeMount(){this.account=this.username},mounted(){this.$refs.account.focus()},methods:{onSubmit:function(){this.msgShow=!1,this.loading=!0,synowebapi.request({api:"SYNO.Auth.ForgotPwd",version:1,method:"send",params:{user:this.account},callback:this.onCallback,scope:this})},onCallback:function(e,t){var s=this.parseResponse(t);s.success?this.$emit("sent-mail"):s.server?(this.setMsg(s.msg),this.redirectToServer(s.server)):(this.loading=!1,this.setError(s.msg))},parseResponse:function(e){var t=this.T("login","error_error_system"),s=!1,i=null,o=e.msg;return 1===o?t=this.T("login","forget_pass_msg_user_not_allowed"):2===o?t=this.T("login","forget_pass_msg_ask_admin"):3===o?(s=!0,t=this.T("login","forget_pass_msg_check_mail")):4===o?t=this.T("login","forget_pass_msg_no_user"):5===o?t=this.T("login","forget_pass_msg_forbidden"):6==o?t=this.T("login","get_redirect_info_fail"):7===o&&(0===e.server.url.length?t=this.T("login","get_redirect_info_fail"):e.server.mail_enabled?(t=this.T("login","redirecting"),i=e.server):t=this.T("login","server_no_mail_service")),{success:s,msg:t,server:i}},redirectToServer:function(e){var t=location.protocol+"//"+location.host,s=this.urlAppend(e.endpoint,this.urlEncode({user:this.account,redirect_url:t})),i="sds-login-forgotpwd-iframe",o=function(e,t){var s;window.removeEventListener("message",o),(s=window.document.getElementById(i)).parentNode.removeChild(s),e.data.success?window.location=e.data.url+t:(this.loading=!1,this.setError(this.T("login","endpoint_not_accessible")))}.createDelegate(this,s,!0);window.addEventListener("message",o);var a=window.document.createElement("iframe");a.id=i,a.src=t+"/webman/detector.html",a.style.display="none",a.onload=function(){a.contentWindow.postMessage(e,t)},window.document.body.appendChild(a)},setError:function(e,t){this.msgText=e||this.T("login","error_error_system"),this.msgCls=t||"error",this.msgShow=!0},setMsg:function(e,t){this.msgText=e,this.msgCls=t||"",this.msgShow=!0},urlAppend:function(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+t:e},urlEncode:function(e){var t=[];for(var s in e)t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")}}},xe,[],!1,null,null,null);Ee.options.__file="js/components/forgotpwd/stepEnterAccount.vue";var Ie=Ee.exports,Me=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-check-mail login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("login","check_mail_title"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc",domProps:{innerHTML:e._s(e.mailDescText)}})])]),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};Me._withStripped=!0;var Ye=_({mixins:[u],computed:{mailDescText(){let e=this.T("login","mail_sent_desc");return e=e.replace("{0}",'<a href="https://www.synology.com/knowledgebase/DSM/tutorial/General_Setup/What_should_I_do_if_I_did_not_receive_the_password_reset_email" target="_blank">'),e=e.replace("{1}","</a>"),e}}},Me,[],!1,null,null,null);Ye.options.__file="js/components/forgotpwd/stepCheckMail.vue";var Ue=_({components:{"step-enter-account":Ie,"step-check-mail":Ye.exports},data:()=>({step:"step-enter-account"}),methods:{onSentMail:function(){this.step="step-check-mail"}}},$e,[],!1,null,null,null);Ue.options.__file="js/pages/forgotPwdPage.vue";var qe=Ue.exports,je=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login-page-common-layout-container login-page-changepwd"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t(this.step,{ref:"stepInstance",tag:"component",on:{"goto-step":this.onGotoStep}})],1)],1)};je._withStripped=!0;var Be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-change-pwd login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("login","change_pass_title"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc"},[e._v("\n          "+e._s(e.desc||e.T("login","passwd_stronger"))+"\n        ")])])]),e._v(" "),s("div",{staticClass:"area-center"},[s("form",{staticClass:"common-simple-form"},[e.showUsername?s("div",{staticClass:"username-field"},[e._v("\n          "+e._s(e.username||e.$route.params.account)+"\n        ")]):e._e(),e._v(" "),e.showPassword?s("textfield",{ref:"password",attrs:{type:"password",placeholder:e.T("personal_settings","old_password")},on:{submit:e.onSubmit},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}):e._e(),e._v(" "),s("textfield",{ref:"newPass",attrs:{"with-strength":"",type:"password",enterkeyhint:e.keyHintText,placeholder:e.T("login","forget_pass_new_password")},on:{submit:e.onSubmit},model:{value:e.newPass,callback:function(t){e.newPass=t},expression:"newPass"}}),e._v(" "),s("textfield",{ref:"confirmPass",attrs:{type:"password",enterkeyhint:e.keyHintText,placeholder:e.T("login","forget_pass_comfirm_password")},on:{submit:e.onSubmit},model:{value:e.confirmPass,callback:function(t){e.confirmPass=t},expression:"confirmPass"}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.confirmPassError,expression:"confirmPassError !== ''"}],staticClass:"confirm-pass-error",domProps:{innerHTML:e._s(e.confirmPassError)}}),e._v(" "),s("login-button",{attrs:{disabled:e.btnDisalbed,spin:e.loading},on:{click:e.onSubmit}},[e._v("\n          "+e._s(e.T("login","submit"))+"\n        ")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.msgShow,expression:"msgShow"}],staticClass:"msg",class:e.msgCls},[s("div",{staticClass:"text",domProps:{innerHTML:e._s(e.msgText)}})])],1)]),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};Be._withStripped=!0;var He=_({components:{textfield:Le,"login-button":Ne},mixins:[u],data(){return{loading:!1,desc:"",newPass:"",password:this.$store.state.mainPage.dsmForm.password||"",confirmPass:"",confirmPassError:"",msgText:"",msgCls:"",msgShow:!1}},computed:{username(){return this.$store.state.mainPage.dsmForm.username},btnDisalbed(){return 0==this.newPass.length||0==this.confirmPass.length},keyHintText(){return this.btnDisalbed?"":"send"},tid(){return this.$route.params.tid||""},showUsername(){return!this.tid},showPassword(){return!this.$store.state.mainPage.dsmForm.password}},watch:{confirmPassError(e){this.$refs.confirmPass.error=""!==e}},mounted(){this.$refs[this.showPassword?"password":"newPass"].focus()},methods:{onSubmit:function(){if(this.btnDisalbed)return;if(this.confirmPassError="",this.msgShow=!1,this.newPass!==this.confirmPass)return void(this.confirmPassError=this.T("login","forget_pass_comfirm_password_error"));if("admin"===this.username&&this.newPass.length<8)return void this.setError(this.T("login","min_length_default").replace("{0}","admin").replace("{1}","8"));this.loading=!0;let e={api:"SYNO.API.Auth",version:6,method:"reset",session:"webui",account:this.username,passwd:this.password,new_passwd:this.newPass};this.tid.length>0&&(e={api:"SYNO.Core.NormalUser",method:"set",version:2,password:JSON.stringify(this.newPass),old_password:JSON.stringify(this.password),tid:this.tid}),synowebapi.request({url:"webapi/entry.cgi",requestFormat:"raw",responseFormat:"raw",method:"POST",params:e,encryption:["username","passwd","new_passwd"],callback:function(e,t){var s=this.parseResponse(t);s.success?(t.data&&t.data.tid&&(this.$route.params.tid=t.data.tid),this.$emit("goto-step","step-change-kick")):(this.setError(s.msg),this.loading=!1)},scope:this})},parseResponse:function(e){var t;if(e&&!0===e.success)return{success:!0,msg:this.T("login","forget_pass_change_pass_ok")};if(!e.error||!e.error.code)return{success:!1,msg:this.T("login","forget_pass_msg_error")};switch(e.error.code){case 3124:case 400:t=this.T("login","error_cantlogin");break;case 403:break;case 404:t=this.T("login","error_otp_failed");break;case 406:break;case 401:case 408:t=this.T("login","error_expired");break;case 407:t=this.T("login","error_max_tries");break;case 402:t=this.T("login","error_noprivilege");break;case 421:var s=[];if(e.error.errors){for(var i in e.error.errors)if(e.error.errors[i])switch(i){case"min_length_enable":s.push(this.T("passwd",i)+" "+e.error.errors[i]);break;default:s.push(this.T("passwd",i))}}else s.push(this.T("login","password_formation_rules")),s.push(this.T("login","need_longer_password")),s.push(this.T("login","exclude_username"));var o=s.filter(e=>""!==e).reduce((e,t)=>`${e}<li>${t}</li>`,"");t=this.T("login","possible_reasons_are").replace("{0}",`<br/><ul align="left">${o}</ul>`);break;case 422:t=this.T("login","password_in_history");break;case 423:t=this.T("login","password_too_common");break;case 499:t=this.T("login","error_system_not_ready");break;case 498:t=this.T("login","error_upgrading");break;case 409:case 410:default:t=this.T("login","forget_pass_msg_error")}return{success:!1,msg:t}},setError:function(e,t){this.msgText=e||this.T("login","error_error_system"),this.msgCls=t||"error",this.msgShow=!0},setMsg:function(e,t){this.msgText=e,this.msgCls=t||"",this.msgShow=!0}}},Be,[],!1,null,null,null);He.options.__file="js/components/changepwd/stepChangePwd.vue";var ze=He.exports,Re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-change-success login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("connections","kick_connection"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc"},[e._v("\n          "+e._s(e.T("connections","confirm_kick_self"))+"\n        ")])])]),e._v(" "),s("div",{staticClass:"area-center"},[s("div",{staticClass:"area-center-contain"},[s("login-button",{staticClass:"btn-kick",attrs:{color:"grey"},on:{click:e.gotoSuccess}},[e._v("\n          "+e._s(e.T("login","skip"))+"\n        ")]),e._v(" "),s("login-button",{staticClass:"btn-kick",attrs:{spin:e.loading},on:{click:e.onKick}},[e._v("\n          "+e._s(e.T("connections","end_connections"))+"\n        ")])],1)]),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};Re._withStripped=!0;var Ge=_({components:{"login-button":Ne},data:()=>({loading:!1}),computed:{tid(){return this.$route.params.tid||""}},mixins:[u],methods:{gotoSuccess:function(){this.$emit("goto-step","step-change-success")},onKick:function(){this.loading=!0;var e={api:"SYNO.Core.CurrentConnection",method:"kick_self",version:1};this.tid.length>0&&(e.tid=this.tid,e.preserve=!0),synowebapi.request({url:"webapi/entry.cgi",requestFormat:"raw",responseFormat:"raw",method:"POST",params:e,callback:function(e,t){this.$emit("goto-step","step-change-success")},scope:this})}}},Re,[],!1,null,null,null);Ge.options.__file="js/components/changepwd/stepChangeKick.vue";var We=Ge.exports,Ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-change-success login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("login","change_success_title"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc"},[e._v("\n          "+e._s(e.T("login","change_success_desc"))+"\n        ")])])]),e._v(" "),""!==e.btntext?s("div",{staticClass:"area-center"},[s("login-button",{staticClass:"btn-login-now",on:{click:e.gotoLogin}},[e._v("\n        "+e._s(e.btntext)+"\n      ")])],1):e._e(),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};Ve._withStripped=!0;const Ke=new URLSearchParams(window.location.search);var Je=_({components:{"login-button":Ne},computed:{return_uri:()=>Ke.has("return_uri")?Ke.get("return_uri"):"",btntext(){return""!==this.return_uri?this.T("login","finish"):this.T("login","login_now")}},mixins:[u],methods:{gotoLogin:function(){if(""!=this.return_uri)return window.location.replace(this.return_uri);this.$store.commit("mainPage/updateDsmPassword",""),this.$router.push({path:"/"})}}},Ve,[],!1,null,null,null);Je.options.__file="js/components/changepwd/stepChangeSuccess.vue";var Xe=_({components:{"step-change-pwd":ze,"step-change-kick":We,"step-change-success":Je.exports},mixins:[u],data:()=>({step:"step-change-pwd"}),beforeRouteEnter:function(e,t,s){s((function(t){"/expired-pwd"===e.redirectedFrom&&(t.$refs.stepInstance.desc=this.T("login","passwd_expired"))}))},methods:{onGotoStep:function(e){this.step=e}}},je,[],!1,null,null,null);Xe.options.__file="js/pages/changePwdPage.vue";var Qe=Xe.exports,Ze=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login-page-common-layout-container login-reset-forgot-password"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t(this.step,{tag:"component",on:{"goto-step":this.onGotoStep}})],1)],1)};Ze._withStripped=!0;var et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-change-pwd login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("login","change_pass_title"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc"},[e._v("\n          "+e._s(e.T("login","change_pass_desc"))+"\n        ")])])]),e._v(" "),s("div",{staticClass:"area-center"},[s("form",{staticClass:"common-simple-form"},[s("textfield",{ref:"newPass",attrs:{"with-strength":"",type:"password",placeholder:e.T("login","forget_pass_new_password")},on:{submit:e.onSubmit},model:{value:e.newPass,callback:function(t){e.newPass=t},expression:"newPass"}}),e._v(" "),s("textfield",{ref:"confirmPass",attrs:{type:"password",placeholder:e.T("login","forget_pass_comfirm_password")},on:{submit:e.onSubmit},model:{value:e.confirmPass,callback:function(t){e.confirmPass=t},expression:"confirmPass"}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.confirmPassError,expression:"confirmPassError !== ''"}],staticClass:"confirm-pass-error",domProps:{innerHTML:e._s(e.confirmPassError)}}),e._v(" "),s("login-button",{attrs:{disabled:0==e.newPass.length||0==e.confirmPass.length||e.disableSubmit,spin:e.loading},on:{click:e.onSubmit}},[e._v("\n          "+e._s(e.T("login","submit"))+"\n        ")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.msgShow,expression:"msgShow"}],staticClass:"msg",class:e.msgCls},[s("div",{staticClass:"text",domProps:{innerHTML:e._s(e.msgText)}})])],1)]),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};et._withStripped=!0;var tt=_({components:{textfield:Le,"login-button":Ne},mixins:[u],data:()=>({disableSubmit:!1,newPass:"",confirmPass:"",confirmPassError:"",msgText:"",msgCls:"",msgShow:!1,loading:!1}),computed:{key(){return this.$route.params.key}},watch:{confirmPassError(e){this.$refs.confirmPass.error=""!==e}},mounted(){this.$refs.newPass.focus()},methods:{onSubmit:function(){this.confirmPassError="",this.msgShow=!1,this.newPass===this.confirmPass?(this.loading=!0,this.disableSubmit=!0,synowebapi.request({api:"SYNO.Auth.ForgotPwd",version:1,method:"reset",params:{passwd:this.newPass,key:this.key},encryption:["passwd","key"],callback:function(e,t){var s=this.parseResponse(t);s.success?this.$emit("goto-step","step-change-success"):(this.setError(s.msg),this.loading=!1,this.disableSubmit=!1)},scope:this})):this.confirmPassError=this.T("login","forget_pass_comfirm_password_error")},parseResponse:function(e){var t=this.T("login","forget_pass_msg_error"),s=!1,i=e.msg,o=[];return"success"===i?(s=!0,t=this.T("login","forget_pass_change_pass_ok")):"weak password"===i?(o=[this.T("login","password_formation_rules"),this.T("login","need_longer_password"),this.T("login","exclude_username")],t=this.T("login","possible_reasons_are").replace("{0}",`<br/>${this.printUnorderedListTags(o)}`)):"weak password domain"===i?(o=[this.T("login","password_formation_rules"),this.T("login","need_longer_password"),this.T("login","exclude_common_password")],t=this.T("login","possible_reasons_are").replace("{0}",`<br/>${this.printUnorderedListTags(o)}`)):"ticket failed"===i?t=this.T("login","forget_pass_msg_incorrect_ticket"):i&&(t=this.T("login",i)||this.T("login","forget_pass_msg_error")),{success:s,msg:t}},setError:function(e,t){this.msgText=e||this.T("login","error_error_system"),this.msgCls=t||"error",this.msgShow=!0},setMsg:function(e,t){this.msgText=e,this.msgCls=t||"",this.msgShow=!0},printUnorderedListTags:function(e){return`<ul align="left">${e.reduce((e,t)=>`${e}<li>${t}</li>`,"")}</ul>`}}},et,[],!1,null,null,null);tt.options.__file="js/components/resetforgotpwd/stepChangePwd.vue";var st=tt.exports,it=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-perfect-scrollbar",[s("div",{staticClass:"step-change-success login-page-common-layout"},[s("div",{staticClass:"area-top"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("\n          "+e._s(e.T("login","change_success_title"))+"\n        ")]),e._v(" "),s("div",{staticClass:"desc"},[e._v("\n          "+e._s(e.T("login","change_success_desc"))+"\n        ")])])]),e._v(" "),s("div",{staticClass:"area-center"},[s("div",{staticClass:"img-new-password-success"}),e._v(" "),s("login-button",{staticClass:"btn-login-now",on:{click:e.gotoLogin}},[e._v("\n        "+e._s(e.T("login","login_now"))+"\n      ")])],1),e._v(" "),s("div",{staticClass:"area-bottom"},[s("p",[e._v(e._s(e.T("copyright","copyright").replace("{0}",(new Date).getFullYear())))])])])])};it._withStripped=!0;var ot=_({components:{"login-button":Ne},mixins:[u],methods:{gotoLogin:function(){window.location="/"}}},it,[],!1,null,null,null);ot.options.__file="js/components/resetforgotpwd/stepChangeSuccess.vue";var at=_({components:{"step-change-pwd":st,"step-change-success":ot.exports},data:()=>({step:"step-change-pwd"}),methods:{onGotoStep:function(e){this.step=e}}},Ze,[],!1,null,null,null);at.options.__file="js/pages/resetForgotPwdPage.vue";var nt=at.exports,rt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-page-upgrade-mask"},[s("div",{staticClass:"panel"},[s("div",{staticClass:"panel-content"},[s("upgrade-loader"),e._v(" "),s("transition",{attrs:{name:"fade",mode:"out-in"}},[s("upgrade-mask-content",{key:e.stage,attrs:{title:e.title,desc:e.desc,"can-login":e.canLogin}})],1),e._v(" "),"check_status"!==e.stage?s("upgrade-mask-indicator",{attrs:{current:e.step.current,total:e.step.total}}):e._e()],1)])])};rt._withStripped=!0;var lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-page-upgrade-content"},[s("div",{staticClass:"panel-title",domProps:{innerHTML:e._s(e.title)}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.desc,expression:"desc"}],staticClass:"panel-desc"},[e._v("\n    "+e._s(e.desc)+"\n  ")]),e._v(" "),s("div",{staticClass:"panel-signin"},[e.canLogin?s("div",{staticClass:"signin-text",on:{click:function(t){return t.preventDefault(),e.goLogin(t)}}},[e._v("\n      "+e._s(e.T("login","sign_in_anyway"))+"\n    ")]):s("div",{staticClass:"attention-text"},[e._v("\n      "+e._s(e.T("login","upgrading_dont_reboot"))+"\n    ")])])])};lt._withStripped=!0;var ct=_({mixins:[u],props:{title:{type:String,default:""},desc:{type:String,default:""},canLogin:{type:Boolean,default:!1}},methods:{goLogin(){this.$store.commit("mainPage/updateShowUpgradeMask",!1),this.$router.push({path:"/signin"})}}},lt,[],!1,null,null,null);ct.options.__file="js/components/upgradeMaskContent.vue";var pt=ct.exports,dt=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"login-page-upgrade-indicator"},[this._v("\n  "+this._s(this.step)+"\n")])};dt._withStripped=!0;var ut=_({mixins:[u],props:{current:{type:Number,default:0},total:{type:Number,default:2}},computed:{step(){return`${this.T("login","step")} ${this.current+1}/${this.total}`}}},dt,[],!1,null,null,null);ut.options.__file="js/components/upgradeMaskIndicator.vue";var ht=_({components:{"upgrade-loader":ye,"upgrade-mask-content":pt,"upgrade-mask-indicator":ut.exports},mixins:[u],data:()=>({canLogin:!1,stage:"check_status",uptime:-1,percentage:0,step:{current:0,total:2},state:{check_status:{status:"not_start",apiChecked:!1,timepassed:!1},timeout:!1,timeoutFromStart:!1,pgsql:{init:!1,status:"not_start"},package:{status:"not_start",current_package_name:"",current_count:0,total_count:0},photos:{status:"not_install",title_key:"photos_migrating_moments_personal",current:0,total:0}}}),computed:{title(){switch(this.stage){case"check_status":return _T("login","check_status_title");case"pgsql":return this.pgsqlTitle;case"pgsql-still-update":case"pgsql-timeout":return this.T("login","pgsql_timeout_title");case"package":case"package-timeout":return this.packageTitle;case"photos":return this.photosTitle;default:return""}},desc(){switch(this.stage){case"pgsql":return this.T("login","pgsql_upgrade_desc");case"pgsql-still-update":return this.T("login","pgsql_still_update_desc");case"pgsql-timeout":return this.T("login","pgsql_timeout_desc");case"package":return this.T("login","pkg_repairing_no_signin_desc");case"package-timeout":return this.T("login","pkg_repairing_desc");case"photos":return this.T("login","photos_upgrade_desc");default:return""}},pgsqlTitle(){return this.T("login","pgsql_upgrade_title").replace("{percentage}",this.percentage)},packageTitle(){if("not_start"===this.state.package.status)return this.T("login","pkg_prepare_title");{let e=this.state.package.current_package_name,t=this.state.package.current_count,s=this.state.package.total_count;return this.T("login","pkg_repairing_title").replace("{package_name}",e).replace("{current}",t).replace("{total}",s)}},photosTitle(){let e=this.state.photos.title_key,t=this.state.photos.current,s=this.state.photos.total;return this.T("login",e).replace("{current}",t).replace("{total}",s)}},watch:{state:{async handler(e){!1!==e.check_status.timepassed&&!1!==e.check_status.apiChecked?("pgsql"===this.stage&&"done"===e.pgsql.status&&(this.setPgsqlProgress(2500,100),await this.sleep(3e3)),e.timeoutFromStart||!1!==e.timeout||"done"===e.pgsql.status?e.timeoutFromStart||!0!==e.timeout||"done"===e.pgsql.status?e.timeoutFromStart&&"done"!==e.pgsql.status?this.goPgsqlTimeout():e.timeoutFromStart||"done"===e.package.status?e.timeoutFromStart&&"done"!==e.package.status?this.goPackageTimeout():"done"!==e.photos.status?this.goPhotos():this.goLogin():this.goPackage():this.goPgsqlStillUpdate():this.goPgsql()):this.goCheckStatus()},deep:!0}},created(){this.registerSDKEvent(),this.goCheckStatus(),this.clearTimeoutFromStart=this.setTimeoutFromStart()},beforeDestroy(){this.$data.$socket&&(this.$data.$socket.disconnect(),this.$data.$socket=null),this.$data.$timeout&&(window.clearTimeout(this.$data.$timeout),this.$data.$timeout=null),this.$data.$progress&&(window.cancelAnimationFrame(this.$data.$progress),this.$data.$progress=null),this.$data.$checkStatusSafety&&(window.cancelAnimationFrame(this.$data.$checkStatusSafety),this.$data.$checkStatusSafety=null),this.clearCurrentStatusTimeout(),this.clearTimeoutFromStart()},methods:{registerSDKEvent(){this.$data.$socket=new SYNO.SDS.Socket({isGuest:!0,autoSwitchToStandaloneMode:!0}),this.$data.$socket.registerSDKEvent("pgsql",this.updatePgsqlStatus),this.$data.$socket.registerSDKEvent("package_autoupgrade_progress",this.updatePackageStatus),this.$data.$socket.register({api:"SYNO.Foto.Migration",version:1,method:"get_status"},e=>{e.success&&this.updatePhotosStatus(e.data)},!1)},getCurrentStatus(){this.uptime=SYNO.SDS.Session.dsm_upgrade_done_uptime,this.state.pgsql.status=this.adaptPgsqlStatus(SYNO.SDS.Session.dsm_upgrade_pgsql_status);let e=[];e.push({api:"SYNO.Core.Package.AutoUpgrade.Progress",method:"get",version:1}),e.push({api:"SYNO.Foto.Migration",method:"get_status",version:1}),e.push({api:"SYNO.Core.Desktop.Upgrade",method:"get_pgsql",version:1}),synowebapi.promises.request({api:"SYNO.Entry.Request",version:1,method:"request",params:{stopwhenerror:!1,mode:"parallel",compound:e}}).then(e=>{let t=e.result[0];t.success?this.updatePackageStatus(t.data):this.state.package.status="done";let s=e.result[1];s.success&&this.updatePhotosStatus(s.data);let i=e.result[2];-1!==this.uptime&&i.success?"done"!==this.state.pgsql.status&&(this.state.pgsql.status=this.adaptPgsqlStatus(i.data.dsm_upgrade_pgsql_status)):this.state.pgsql.status="done",this.state.check_status.apiChecked=!0}).catch(e=>{this.state.check_status.apiChecked=!0,this.state.package.status="done",SYNO.Debug(e)}),this.clearCurrentStatusTimeout(),this.$options.currentStatusTimer=window.setTimeout(this.getCurrentStatus,6e4)},setTimeoutFromStart(){const e=3600-Math.max(this.uptime,0),t=window.setTimeout(()=>{this.state.timeoutFromStart=!0},Math.max(1e3*e,0));return()=>window.clearTimeout(t)},initPgsqlProgress(e){if("done"===this.state.pgsql.status||!0===this.state.pgsql.init)return;let t=0;if(e<=0)t=900;else{if(e>=900)return void(this.state.timeout=!0);t=900-e}this.percentage=this.calcPgsqlPercentage(e),this.setTimeout(t),this.setPgsqlProgress(1e3*t,90),this.state.pgsql.init=!0},goCheckStatus(){"not_start"===this.state.check_status.status&&(this.canLogin=!1,this.step.current=0,this.stage="check_status",this.state.check_status.status="checking",this.getCurrentStatus(),window.setTimeout(()=>{this.state.check_status.timepassed=!0},3e3),this.$data.$checkStatusSafety=window.setTimeout(()=>{"check_status"===this.stage&&(this.state.check_status.timepassed=!0,this.state.check_status.apiChecked=!0)},15e3))},goPgsql(){this.initPgsqlProgress(this.uptime),this.step.current=0,this.stage="pgsql"},goPgsqlStillUpdate(){this.step.current=0,this.stage="pgsql-still-update"},goPgsqlTimeout(){this.step.current=0,this.stage="pgsql-timeout",this.canLogin=!0},goPackage(){this.step.current=1,this.stage="package"},goPackageTimeout(){this.stage="package-timeout",this.step.current=1,this.canLogin=!0},goPhotos(){synowebapi.promises.request({api:"SYNO.Foto.Migration",method:"get_status",version:1}).then(e=>{this.updatePhotosStatus(e),this.canLogin=!0,this.step.current=1,this.stage="photos"}).catch(()=>{this.state.photos.status="done"})},goLogin(){this.apiSetAllDone(),this.$store.commit("mainPage/updateShowUpgradeMask",!1),this.$router.push({path:"/signin"})},updatePgsqlStatus(e){this.state.pgsql.status=this.adaptPgsqlStatus(e.status)},updatePackageStatus(e){this.state.package.status=this.adaptPackageStatus(e.status),this.state.package.current_package_name=e.current_package_name,this.state.package.current_count=e.current_count,this.state.package.total_count=e.total_count},updatePhotosStatus(e){this.state.photos.status=this.adaptPhotosStatus(e.status),this.state.photos.current=e.current,this.state.photos.total=e.total,this.state.photos.title_key=e.title_key},adaptPgsqlStatus(e){if("done"===this.state.pgsql.status)return"done";let t=e;return"active"===e||"failed"===e||"error"===e?t="done":"inactive"===e&&(t="not_start"),t},adaptPackageStatus(e){let t=e;return"finished"===e?t="done":"not_started"===e&&(t="not_start"),t},adaptPhotosStatus(e){let t=e;return"not start"===e&&(t="not_start"),t},apiSetAllDone(){synowebapi.request({api:"SYNO.Core.Desktop.Upgrade",method:"done",version:1})},setTimeout(e){e<=0?this.state.timeout=!0:(this.$data.$timeout&&(window.clearTimeout(this.$data.$timeout),this.$data.$timeout=null),this.$data.$timeout=window.setTimeout(()=>{this.state.timeout=!0},1e3*e))},setPgsqlProgress(e,t){if(e<=0)return;let s=t-this.percentage;s<=0||(this.$data.$progress&&(window.cancelAnimationFrame(this.$data.$progress),this.$data.$progress=null),this.$data.$progress=window.requestAnimationFrame(i=>{!function e(t,s,i,o,a,n,r){i||(i=s);let l=(s-i)/a;l>1&&(l=1),t.percentage=Math.ceil(l*n+o),t.percentage<r&&(t.$data.$progress=window.requestAnimationFrame(s=>{e(t,s,i,o,a,n,r)}))}(this,i,null,this.percentage,e,s,t)}))},calcPgsqlPercentage(e){let t=0;return t=e>=900?90:e<=0?0:Math.ceil(90*e/900),t},sleep:e=>new Promise((function(t){setTimeout((function(){t()}),e)})),clearCurrentStatusTimeout(){this.$options.currentStatusTimer&&(window.clearTimeout(this.$options.currentStatusTimer),this.$options.currentStatusTimer=null)}}},rt,[],!1,null,null,null);ht.options.__file="js/pages/upgradeMaskPage.vue";var mt=ht.exports,gt={methods:{removeVueRouterHash(){("#/"===window.location.hash||window.location.hash.startsWith("#/signin"))&&history&&history.replaceState&&history.replaceState("",document.title,window.location.pathname+window.location.search)}}},_t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-tabs-content-wrapper"},[s("div",{staticClass:"tab-panel-title"},[e._v("\n    "+e._s(e.T("login","sign_in"))+"\n  ")]),e._v(" "),s("div",{class:e.loginFieldsetCls},[s("form",{attrs:{id:"dsm-user-fieldset"},on:{submit:function(e){e.preventDefault(),e.stopPropagation()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onClickNext(t)}}},[s("textfield",{ref:"username",staticClass:"field",attrs:{type:"text",autofillname:"username",autofocus:e.autofocusUsername,placeholder:e.T("login","username"),bordercolor:e.mainColor,disabled:e.disableInput,tabindex:1,"syno-id":"username"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),s("input",{attrs:{type:"password",name:"password",tabindex:"-1",hidden:""}})],1)]),e._v(" "),s("next-btn",{ref:"nextBtn",attrs:{"is-mobile":e.shouldUseMobileStyle,tabindex:2,"syno-id":"account-panel-next-btn"},on:{"btn-click":e.onClickNext}})],1)};_t._withStripped=!0;var vt=_({name:"DSMAccountPanel",components:{textfield:Le,"next-btn":G},mixins:[k,q,u],data:()=>({disabled:!1,waiting:!1}),computed:{...Object(a.mapState)("mainPage",["loginPluginsLoaded","activeTabName","loadPluginsPromise"]),...Object(a.mapGetters)("mainPage",["enabledAuthList"]),autofocusUsername(){return!0!==this.disabled},disableInput(){return this.disabled||this.isPreview},username:{get(){return this.$store.state.mainPage.dsmForm.username},set(e){this.$store.commit("mainPage/updateDsmUsername",e)}}},watch:{username(e){""===e?this.$refs.nextBtn.disable():this.$refs.nextBtn.pulse(!0)},activeTabName(e){"dsmTabPanel"===e&&this.focusInput()}},created(){!0===_S("preview")&&(this.disabled=!0),this.$options.$stopStoreSubscribe=this.$store.subscribe(e=>{"mainPage/loginPluginsLoaded"===e.type&&!0===e.payload&&this.waiting&&this.goNextStep()})},beforeMount(){this.clearAuthInfo(),(SYNO.SDS.Session.app_name||SYNO.SDS.Session.appName||SYNO.SDS.Session.appLoginStyle)&&this.fillLastLoginInfo()},mounted(){this.initNextBtnStatus(),this.autoFocus()},beforeDestroy(){this.$options.$stopStoreSubscribe()},methods:{...Object(a.mapActions)("mainPage",["clearAuthInfo","clearMessage","fetchAuthList"]),initNextBtnStatus(){""===this.username?this.$refs.nextBtn.disable():this.$refs.nextBtn.pulse(!0)},clearAvatarInfo(){localStorage.removeItem("lastLoginUsername")},async onClickNext(){this.disabled||this.$refs.nextBtn.disabled||(this.loading(),await this.loadPluginsPromise,await this.fetchAuthList(this.username),this.goNextStep())},goNextStep(){this.loading(!1),this.username!==localStorage.getItem("lastLoginUsername")&&this.clearAvatarInfo(),this.clearMessage();const e=this.enabledAuthList[0]&&this.enabledAuthList[0].type||"passwd";let t=SYNO.SDS.LoginPlugins.getPlugin(e);if(void 0===t)return SYNO.Debug.error(`No such plugin [${e}]`),void this.$router.push("/signin/password");this.$router.push(t.entry)},loading(e=!0){this.waiting=e,this.$refs.nextBtn&&this.$refs.nextBtn.spin(e)},autoFocus:function(){document.activeElement.blur(),this.$nextTick(()=>{"dsmTabPanel"===this.activeTabName&&this.focusInput()})},focusInput(){this.$refs.username.$refs.input.focus()},fillLastLoginInfo(){void 0!==localStorage.getItem("lastLoginUsername")&&null!==localStorage.getItem("lastLoginUsername")&&(this.username=localStorage.getItem("lastLoginUsername"))}}},_t,[],!1,null,null,null);vt.options.__file="js/components/auth/dsmAccountPanel.vue";var ft=vt.exports,bt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"plugin-selector"},[s("div",{staticClass:"tab-panel-title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),s("table",{staticClass:"plugin-table",attrs:{id:"plugin-list"}},e._l(e.pluginList,(function(t,i){return s("tr",{key:i,staticClass:"plugin-cell",on:{click:function(s){return s.preventDefault(),e.callItemCallback(t)}}},[s("div",{staticClass:"plugin-wrapper"},[s("img",{staticClass:"plugin-icon",attrs:{src:e.getPluginIconPath(t)}}),e._v(" "),s("div",{staticClass:"plugin-desc",domProps:{innerHTML:e._s(t.itemInfo.description)}})])])})),0),e._v(" "),s("div",{staticClass:"footer"},[e.showForgotPwd?s("div",{staticClass:"footer-link-ct"},[s("span",[e._v(e._s(e.T("login","account_recover_desc")))]),e._v(" "),s("router-link",{staticClass:"footer-link",attrs:{to:"/forgot-pwd"}},[e._v("\n        "+e._s(e.T("login","action_reset_password"))+"\n      ")])],1):e._e(),e._v(" "),e.showLostDevice?s("div",{staticClass:"footer-link-ct"},[s("span",[e._v(e._s(e.T("login","2fa_account_recover_desc")))]),e._v(" "),s("a",{staticClass:"footer-link",on:{click:e.onLostPhoneClick}},[e._v("\n        "+e._s(e.T("login","action_emerg_code"))+"\n      ")])]):e._e()])])};bt._withStripped=!0;var St=_({name:"AuthSelector",mixins:[u],data:()=>({pluginList:[]}),computed:{...Object(a.mapState)("mainPage",["need2FA"]),...Object(a.mapGetters)("mainPage",["enabledAuthList","username"]),showForgotPwd(){let e=1===_S("login_enable_fp"),t=this.need2FA;return e&&!t},showLostDevice(){if(!this.need2FA)return!1;return!!this.enabledAuthList.some(e=>"otp"===e.type)},title(){return this.need2FA?this.T("login","try_another_way_title"):this.T("login","select_a_way_title")}},beforeMount(){this.loadPluginList()},methods:{...Object(a.mapActions)("mainPage",["setInfoMessage","setErrorMessage"]),loadPluginList(){for(let e of this.enabledAuthList){if(void 0===e.type){SYNO.Debug.error("missing plugin type.");continue}let t=e.type,s=SYNO.SDS.LoginPlugins.plugins[t];void 0!==s?s.routeOnly||(s.itemInfo?this.pluginList.push(s):SYNO.Debug.error(`Plugin [${t}] doesn't have item info.`)):SYNO.Debug.error(`Plugin [${t}] not registered.\n- Ensure the [id] in ui plugin is same as the [type] in worker.\n- Ensure you have called SYNO.SDS.LoginPlugins.register()`)}},callItemCallback(e){e.itemInfo.callback&&(e.itemInfo.callback(this.$router,this.$store),localStorage.setItem("choseAuthType",e.id))},getPluginIconPath(e){let t="";return t=SYNO.SDS.UIFeatures.IconSizeManager.isRetinaMode()?e.itemInfo.icon2xPath:e.itemInfo.iconPath,t?`${t}?v=${(new Date).getTime()}`:""},onLostPhoneClick:function(){synowebapi.request({api:"SYNO.Core.OTP.Mail",method:"send",version:1,params:{username:this.username},scope:this,callback:function(e,t){var s=this.T("login","unknown_otp_err");e?s=this.T("login","otp_emerg_code_success"):t.errors&&t.errors.err&&(s=this.T("login",t.errors.err)),this.$emit("show-toast",s,1e4),this.$router.replace("/signin/otp")}})}}},bt,[],!1,null,"92af6852",null);St.options.__file="js/components/auth/authSelectorPanel.vue";var wt=St.exports,yt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"login-tabs-content-wrapper"},[s("div",{staticClass:"tab-panel-title"},[e._v("\n      "+e._s(e.T("login","login_enter_password"))+"\n    ")]),e._v(" "),s("div",{class:e.loginFieldsetCls},[s("form",{attrs:{id:"dsm-pass-fieldset"},on:{submit:function(e){e.preventDefault(),e.stopPropagation()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onLogin(t)}}},[s("input",{attrs:{name:"username",autocomplete:"off",tabindex:"-1",hidden:""},domProps:{value:e.username}}),e._v(" "),s("textfield",{ref:"password",staticClass:"password-field field",attrs:{type:"password",autofillname:"current-password",placeholder:e.T("login","password"),bordercolor:e.mainColor,tabindex:0,"syno-id":"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),e.isMobileDevice?e._e():s("checkbox",{attrs:{label:e.T("login","rememberme"),tabindex:0},model:{value:e.stayLogin,callback:function(t){e.stayLogin=t},expression:"stayLogin"}})],1)]),e._v(" "),s("div",{staticClass:"login-remain-section"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.message,expression:"message"}],staticClass:"login-msg-box",class:[e.messageCls],domProps:{innerHTML:e._s(e.message)}})]),e._v(" "),s("next-btn",{ref:"nextBtn",attrs:{"is-mobile":e.shouldUseMobileStyle,tabindex:0,"syno-id":"password-panel-next-btn"},on:{"btn-click":e.onLogin}})],1),e._v(" "),s("div",{staticClass:"tab-footer"},[e.enabledAuthList.length>1?s("div",{staticClass:"tab-footer-link-ct"},[s("router-link",{staticClass:"tab-footer-link try-other-ways",attrs:{to:"/signin/select-auth",replace:""}},[e._v("\n        "+e._s(e.T("login","other_ways"))+"\n      ")])],1):e._e(),e._v(" "),e.showForgotPwd?s("div",{staticClass:"tab-footer-link-ct"},[s("router-link",{staticClass:"tab-footer-link",attrs:{to:"/forgot-pwd"}},[e._v("\n        "+e._s(e.T("login","forget_pass_link"))+"\n      ")])],1):e._e()])])};yt._withStripped=!0;var Pt=_({name:"DSMPasswordPanel",components:{textfield:Le,checkbox:H,"next-btn":G},mixins:[k,q,u],data:()=>({showForgotPwd:1===_S("login_enable_fp")}),computed:{...Object(a.mapState)("mainPage",["activeTabName"]),...Object(a.mapGetters)("mainPage",["enabledAuthList"]),isMobileDevice:()=>_S("isMobileDevice"),isLoginError(){return!!this.$store.state.mainPage.message},username(){return this.$store.state.mainPage.dsmForm.username},password:{get(){return this.$store.state.mainPage.dsmForm.password},set(e){this.$store.commit("mainPage/updateDsmPassword",e)}},stayLogin:{get(){return this.$store.state.mainPage.stayLogin},set(e){this.$store.commit("mainPage/updateStayLogin",e)}}},watch:{isLoginError(e){!0===e&&this.focusInput()},activeTabName(e){"dsmTabPanel"===e&&this.focusInput()}},beforeMount:function(){this.stayLogin="1"===SYNO.SDS.GetCookieByName("stay_login")},mounted(){this.autoFocus(),this.setStayLoginIfMobile(),this.setStayLoginIfFisrtDVA()},methods:{onLogin(){this.$emit("do-login")},focusInput(){this.$refs.password.$refs.input.focus()},autoFocus:function(){document.activeElement.blur(),this.$nextTick(()=>{"dsmTabPanel"===this.activeTabName&&this.focusInput()})},setStayLoginIfMobile(){this.isMobileDevice&&(this.stayLogin=!0)},setStayLoginIfFisrtDVA(){navigator.userAgent.includes("SurvLocalDisplay")&&null===SYNO.SDS.GetCookieByName("stay_login")&&(this.stayLogin=!0)}}},yt,[],!1,null,null,null);Pt.options.__file="js/components/auth/dsmPasswordPanel.vue";var kt=Pt.exports;class Tt{constructor(e,t){this._itemCallback=this.getItemCallback(e),this._routes=this.getRoutes(t)}get id(){return"passwd"}get entry(){return"/signin/password"}get itemInfo(){return{iconPath:"webman/login/images/1x/icn_password.png",icon2xPath:"webman/login/images/2x/icn_password.png",description:_T("login","plugin_password_desc"),callback:this._itemCallback}}get routes(){return this._routes}getItemCallback(e){return()=>{e.replace("/signin/password")}}getRoutes(e){return[{path:"/signin/password",component:kt,beforeEnter:function(t,s,i){""===e.state.mainPage.dsmForm.username?i("/signin"):i()}}]}}var Ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"login-tabs-content-wrapper"},[s("div",{staticClass:"tab-panel-title"},[e._v("\n      "+e._s(e.T("login","enter_verification_code"))+"\n    ")]),e._v(" "),s("div",{class:e.loginFieldsetCls},[s("div",{attrs:{id:"dsm-otp-fieldset"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onLogin(t)}}},[s("textfield",{ref:"OTPcode",staticClass:"field",attrs:{type:"text",autofillname:"one-time-code",placeholder:e.T("login","otp_code"),tabindex:1},scopedSlots:e._u([{key:"after-input",fn:function(){return[e.otpUrl?s("a",{staticClass:"otp-link",attrs:{target:"_blank",href:e.otpUrl}},[e._v("\n                "+e._s(e.T("login","view_otp"))+"\n              ")]):e._e()]},proxy:!0}]),model:{value:e.OTPcode,callback:function(t){e.OTPcode=t},expression:"OTPcode"}}),e._v(" "),e.isMobileDevice?e._e():s("checkbox",{attrs:{label:e.T("login","trustdevice"),tabindex:2},model:{value:e.trustDevice,callback:function(t){e.trustDevice=t},expression:"trustDevice"}})],1)]),e._v(" "),s("div",{staticClass:"login-remain-section"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.message,expression:"message"}],staticClass:"login-msg-box",class:[e.messageCls],domProps:{innerHTML:e._s(e.message)}})]),e._v(" "),s("next-btn",{ref:"nextBtn",attrs:{"is-mobile":e.shouldUseMobileStyle,tabindex:3,"syno-id":"otp-panel-next-btn"},on:{"btn-click":e.onLogin}})],1),e._v(" "),s("div",{staticClass:"tab-footer"},[e.enabledAuthList.length>1?s("div",{staticClass:"tab-footer-link-ct"},[s("router-link",{staticClass:"tab-footer-link try-other-ways",attrs:{to:"/signin/select-auth",replace:""}},[e._v("\n        "+e._s(e.T("login","try_another_way"))+"\n      ")])],1):e._e(),e._v(" "),s("div",{staticClass:"tab-footer-link-ct"},[s("a",{staticClass:"tab-footer-link",on:{click:e.onLostPhoneClick}},[e._v("\n        "+e._s(e.T("login","otp_lost_device_desc"))+"\n      ")])])])])};Ct._withStripped=!0;var $t=_({name:"OTPPanel",components:{textfield:Le,checkbox:H,"next-btn":G},mixins:[k,q,u],computed:{...Object(a.mapState)("mainPage",["activeTabName","otpUrl"]),...Object(a.mapGetters)("mainPage",["enabledAuthList"]),isMobileDevice:()=>_S("isMobileDevice"),isLoginError(){return!!this.$store.state.mainPage.message},username(){return this.$store.state.mainPage.dsmForm.username},OTPcode:{get(){return this.$store.state.mainPage.dsmForm.OTPcode},set(e){this.$store.commit("mainPage/updateDsmOTPcode",e)}},trustDevice:{get(){return this.$store.state.mainPage.trustDevice},set(e){this.$store.commit("mainPage/updateTrustDevice",e)}}},watch:{OTPcode(e){""===e?this.$refs.nextBtn.disable():this.$refs.nextBtn.pulse(!0)},isLoginError(e){!0===e&&this.focusInput()},activeTabName(e){"dsmTabPanel"===e&&this.focusInput()}},mounted(){this.autoFocus(),this.setTrustDeviceIfMobile(),this.$refs.nextBtn.disable()},methods:{onLogin(){return/^\d+$/.test(this.OTPcode)?/^[0-9]{6}$/.test(this.OTPcode)||/^[0-9]{8}$/.test(this.OTPcode)?void this.$emit("do-login"):(this.$store.state.mainPage.message=this.T("login","otp_wrong_input_format"),void(this.$store.state.mainPage.messageStyle="error")):(this.$store.state.mainPage.message=this.T("login","error_otp_not_number_failed"),void(this.$store.state.mainPage.messageStyle="error"))},onLostPhoneClick:function(){synowebapi.request({api:"SYNO.Core.OTP.Mail",method:"send",version:1,params:{username:this.username},scope:this,callback:function(e,t){var s=this.T("login","unknown_otp_err");e?s=this.T("login","otp_emerg_code_success"):t.errors&&t.errors.err&&(s=this.T("login",t.errors.err)),this.$emit("show-toast",s,1e4)}})},focusInput(){this.$refs.OTPcode.$refs.input.focus()},autoFocus:function(){document.activeElement.blur(),this.$nextTick(()=>{"dsmTabPanel"===this.activeTabName&&this.focusInput()})},setTrustDeviceIfMobile(){this.isMobileDevice&&(this.trustDevice=!0)}}},Ct,[],!1,null,"50744a4f",null);$t.options.__file="js/components/auth/otpPanel.vue";var xt=$t.exports;class Ot{constructor(e,t){this._itemCallback=this.getItemCallback(e),this._routes=this.getRoutes(t)}get id(){return"otp"}get entry(){return"/signin/otp"}get itemInfo(){return{iconPath:"webman/login/images/1x/icn_otp.png",icon2xPath:"webman/login/images/2x/icn_otp.png",description:_T("login","plugin_otp_desc"),callback:this._itemCallback}}get routes(){return this._routes}getItemCallback(e){return()=>{e.replace("/signin/otp")}}getRoutes(e){return[{path:"/signin/otp",component:xt,beforeEnter:function(t,s,i){""===e.state.mainPage.dsmForm.username?i("/signin"):i()}}]}}const Dt=new URLSearchParams(window.location.search);SYNO.CreateLoginInstance=async function({goToPersonalUpdater:e=!1}={}){const t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","width=device-width, initial-scale=1.0"),document.getElementsByTagName("head")[0].appendChild(t),o.a.use(n.a),o.a.use(l.a);let s=new n.a.Store({modules:{mainPage:c,otpWizard:p}});const i=Dt.get("account");s.commit("mainPage/updatePersonalUpdater",e),i&&(s.commit("mainPage/enableSpecificAccount"),await s.dispatch("mainPage/fetchAuthList",i));const r=Dt.get("otp_url");if(r){["https://securesignin.synology.com/otp/view","synology-securesignin://otp/view","synology-securesignin-cn://otp/view"].includes(r)&&s.commit("mainPage/updateOtpUrl",r)}let d=new l.a({routes:[{path:"/signin",component:Ce,beforeEnter:function(e,t,i){s.state.mainPage.showUpgradeMask&&!1===SYNO.SDS.Session.dsm_upgrade_all_done&&-1!==SYNO.SDS.Session.dsm_upgrade_done_uptime?i("/upgrading"):(!1===SYNO.SDS.Session.dsm_upgrade_all_done&&-1===SYNO.SDS.Session.dsm_upgrade_done_uptime&&synowebapi.request({api:"SYNO.Core.Desktop.Upgrade",method:"done",version:1}),i())},children:[{path:"",component:ft,async beforeEnter(e,t,i){if(s.state.mainPage.isSpecificAccount){await s.state.mainPage.loadPluginsPromise;const e=s.getters["mainPage/enabledAuthList"],t=e[0]&&e[0].type||"passwd";let o=SYNO.SDS.LoginPlugins.getPlugin(t);o?i(o.entry):(SYNO.Debug.error(`No such plugin [${t}]`),i("/signin/password"))}else i()}},{path:"/signin/select-auth",component:wt,beforeEnter:function(e,t,i){s.commit("mainPage/enableSpinning",!1),s.state.mainPage.dsmForm.username?i():i("/signin")}}]},{path:"/reset-forgot-pwd/:key",component:nt,beforeEnter:function(e,t,s){synowebapi.request({api:"SYNO.Auth.ForgotPwd",version:1,method:"get",params:e.params,callback:function(e,t){e?s():s("/signin")},scope:this})}},{path:"/forgot-pwd",component:qe},{name:"change-pwd",path:"/change-pwd",component:Qe,beforeEnter:function(e,t,i){s.state.mainPage.dsmForm.username?i():i("/signin")}},{path:"/change-pwd/:tid",component:Qe},{path:"/expired-pwd",redirect:"/change-pwd"},{path:"/upgrading",component:mt,beforeEnter:function(e,t,i){s.state.mainPage.showUpgradeMask&&!0!==SYNO.SDS.Session.dsm_upgrade_all_done?i():i("/signin")}},{path:"*",redirect:"/signin"}]});d.beforeEach((e,t,s)=>{Object.keys(t.query).length>0&&0==Object.keys(e.query).length?s(Object.assign({},e,{query:t.query})):s()}),SYNO.SDS.LoginPlugins.register(Tt),SYNO.SDS.LoginPlugins.register(Ot);const u=async function({router:e,store:t}){try{const e=await async function(){return await synowebapi.promises.request({api:"SYNO.API.Auth.UIConfig",method:"get",version:1})}();await async function(e){let t=[];for(let o of e)void 0!==o.jsPath&&void 0!==o.version&&t.push(new Promise((e,t)=>{i(o.jsPath,o.version,e,t)})),o.cssPath&&o.version&&s(`${o.cssPath}?v=${o.version}`),void 0!==o.texts&&(void 0===SYNO.SDS.Strings?SYNO.SDS.Strings=o.texts:Object.assign(SYNO.SDS.Strings,o.texts));return await Promise.all(t).then(()=>{o()}).catch(e=>{o(),SYNO.Debug.error(e)})}(e)}catch(e){SYNO.Debug.error(e),o()}async function s(e=""){if(!e)return;const t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("head")[0].appendChild(t),new Promise((e,s)=>{t.addEventListener("load",e),t.addEventListener("error",s)})}function i(e,t,s,i){let o=document.getElementsByTagName("head")[0],a=document.createElement("script"),n=e;n=`${e}?v=${t}`,a.type="text/javascript",Ext.isIE?(a.onready=s,a.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||this.onready()}):a.onload=s,a.async=!0,a.onerror=i,a.src=n,o.appendChild(a)}function o(){let s=(t,s)=>{let{routes:i}=e.options,o=i.find(e=>e.path===t);void 0!==o&&(void 0===o.children?o.children=[s]:o.children.push(s),e.addRoutes([o]))},i=SYNO.SDS.LoginPlugins.loadPlugins(e,t);for(let t in i){const o=i[t];if(o.routeOnly)e.addRoutes(o.routes);else for(let e of o.routes)s("/signin",e);SYNO.Debug.debug(`Login Plugin [${t}] loaded.`)}}}({router:d,store:s}).then(()=>s.commit("mainPage/loginPluginsLoaded",!0));s.commit("mainPage/updateLoadPluginsPromise",u),SYNO.LoginInstance=new o.a({el:"#sds-login-vue",store:s,router:d,mixins:[gt],provide(){return{gotoDesktop:this.gotoDesktop,setSynoToken:this.setSynoToken}},computed:{...Object(a.mapState)("mainPage",{username:e=>e.dsmForm.username})},beforeDestroy(){let e=document.querySelectorAll(".grow-bg");for(let t of e)null!==t.offsetParent&&(t.style.transform="scale(1)",t.style.transition="transform 500ms");document.querySelectorAll(".login-btn-spinner-wrapper").forEach(e=>e.classList.add("fade-out")),function(e){e.detach(),e=null}(d)},destroyed(){let e=this.$el;e.classList.add("fade-out"),e.addEventListener("transitionend",(function(t){t.target===e&&(SYNO.SDS.Utils.UserAgent.isIE||SYNO.SDS.Utils.UserAgent.isModernIE?e.parentNode.removeChild(e):e.remove())})),SYNO.SDS.LoginPlugins.release()},methods:{setSynoToken:function(e){Ext.isEmpty(SYNO.SDS.Session)&&(SYNO.SDS.Session={}),e&&(SYNO.SDS.Session.SynoToken=encodeURIComponent(e),synowebapi&&synowebapi.env.setSynoToken(SYNO.SDS.Session.SynoToken))},gotoDesktop:function(e){e&&this.setSynoToken(e),(SYNO.SDS.Session.app_name||SYNO.SDS.Session.appName||SYNO.SDS.Session.appLoginStyle)&&this.saveUsername(),this.removeVueRouterHash(),SYNO.SDS.initData()},saveUsername:function(){localStorage.setItem("lastLoginUsername",this.username)}},template:'\n    <div id="sds-login-vue-inst">\n      <transition name="fade" mode="out-in">\n        <router-view ref="view"></router-view>\n      </transition>\n    </div>'})},SYNO.ShowResetForgotPassword=function(){const e=document.createElement("meta");e.setAttribute("name","viewport"),e.setAttribute("content","width=device-width, initial-scale=1.0"),document.getElementsByTagName("head")[0].appendChild(e),SYNO.ResetForgotPwdInstance=new o.a({el:"#sds-login-reset-forgot-pwd",components:{"login-reset-forgot-password":nt},template:'\n    <div id="sds-login-reset-forgot-pwd-inst">\n      <login-reset-forgot-password/>\n    </div>'})}}]);